<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage-filtered.info - appTest/instadam.cpp</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">appTest</a> - instadam.cpp<span style="font-size: 80%;"> (source / <a href="instadam.cpp.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage-filtered.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">590</td>
            <td class="headerCovTableEntry">899</td>
            <td class="headerCovTableEntryLo">65.6 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2019-04-12 11:19:13</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">39</td>
            <td class="headerCovTableEntry">58</td>
            <td class="headerCovTableEntryLo">67.2 %</td>
          </tr>
          <tr>
            <td class="headerItem">Legend:</td>
            <td class="headerValueLeg">            Lines:
            <span class="coverLegendCov">hit</span>
            <span class="coverLegendNoCov">not hit</span>
            | Branches:
            <span class="coverLegendCov">+</span> taken
            <span class="coverLegendNoCov">-</span> not taken
            <span class="coverLegendNoCov">#</span> not executed
</td>
            <td></td>
            <td class="headerItem">Branches:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntryHi">-</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">           Branch data     Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>                :            : #include &quot;instadam.h&quot;</a>
<span class="lineNum">       2 </span>                :            : 
<span class="lineNum">       3 </span>                :            : #include &lt;QByteArray&gt;
<span class="lineNum">       4 </span>                :            : #include &lt;QDialog&gt;
<span class="lineNum">       5 </span>                :            : 
<span class="lineNum">       6 </span>                :            : #include &lt;iostream&gt;
<span class="lineNum">       7 </span>                :            : #include &lt;fstream&gt;
<span class="lineNum">       8 </span>                :            : #include &lt;string&gt;
<span class="lineNum">       9 </span>                :            : #include &lt;algorithm&gt;
<span class="lineNum">      10 </span>                :            : 
<span class="lineNum">      11 </span>                :            : #include &quot;ui_instadam.h&quot;
<span class="lineNum">      12 </span>                :            : #include &quot;ui_projectDialog.h&quot;
<span class="lineNum">      13 </span>                :            : #include &quot;pixmapops.h&quot;
<span class="lineNum">      14 </span>                :            : #include &quot;filtercontrols.h&quot;
<span class="lineNum">      15 </span>                :            : #include &quot;labelButton.h&quot;
<span class="lineNum">      16 </span>                :            : #include &quot;Selector/selectItem.h&quot;
<span class="lineNum">      17 </span>                :            : #include &quot;Selector/ellipseSelect.h&quot;
<span class="lineNum">      18 </span>                :            : #include &quot;Selector/rectangleSelect.h&quot;
<span class="lineNum">      19 </span>                :            : #include &quot;Selector/polygonSelect.h&quot;
<span class="lineNum">      20 </span>                :            : #include &quot;Selector/freeDrawSelect.h&quot;
<span class="lineNum">      21 </span>                :            : #include &quot;Selector/freeDrawErase.h&quot;
<span class="lineNum">      22 </span>                :            : #include &quot;Selector/commands.h&quot;
<span class="lineNum">      23 </span>                :            : #include &quot;quazip/quazip.h&quot;
<span class="lineNum">      24 </span>                :            : #include &quot;quazip/quazipfile.h&quot;
<span class="lineNum">      25 </span>                :            : #include &quot;startingwidget.h&quot;
<span class="lineNum">      26 </span>                :            : #include &quot;imagelist.h&quot;
<span class="lineNum">      27 </span>                :            : #ifdef WASM_BUILD
<span class="lineNum">      28 </span>                :            : #include &quot;htmlFileHandler/qhtml5file.h&quot;
<span class="lineNum">      29 </span>                :            : #endif
<span class="lineNum">      30 </span>                :            : 
<span class="lineNum">      31 </span>                :            : 
<span class="lineNum">      32 </span>                :            : 
<span class="lineNum">      33 </span>                :            : /*!
<span class="lineNum">      34 </span>                :            :   \class InstaDam
<span class="lineNum">      35 </span>                :            :   \ingroup app
<span class="lineNum">      36 </span>                :            :   \inmodule InstaDam
<span class="lineNum">      37 </span>                :            :   \inherits QMainWindow
<span class="lineNum">      38 </span>                :            :   \brief The InstaDam class defined the main window for the app.
<span class="lineNum">      39 </span>                :            : 
<span class="lineNum">      40 </span>                :            :   InstaDam is the main window class for the InstaDam app. The class includes
<span class="lineNum">      41 </span>                :            :   all the signals, initialization and slots of the various buttons and tools that can be
<span class="lineNum">      42 </span>                :            :   selected from the main window.
<span class="lineNum">      43 </span>                :            :   */
<span class="lineNum">      44 </span>                :            : 
<span class="lineNum">      45 </span>                :            : /*!
<span class="lineNum">      46 </span>                :            :   Constructs an InstaDam window given QString \a databaseURL, Qstring \a token
<span class="lineNum">      47 </span>                :            :   and QMainWindow \a parent, if any. The constructor connects all the buttons
<span class="lineNum">      48 </span>                :            :   in the main window.
<span class="lineNum">      49 </span>                :            :   */
<span class="lineNum">      50 </span>                :            : 
<span class="lineNum">      51 </span>                :<span class="lineCov">          7 : InstaDam::InstaDam(QWidget *parent, QString databaseURL, QString token) :</span>
<span class="lineNum">      52 </span>                :<span class="lineCov">         70 :     QMainWindow(parent), ui(new Ui::InstaDam) {</span>
<span class="lineNum">      53 </span>                :<span class="lineCov">          7 :     ui-&gt;setupUi(this);</span>
<span class="lineNum">      54 </span>                :<span class="lineCov">          7 :     filterControl = new filterControls();</span>
<span class="lineNum">      55 </span>                :<span class="lineCov">         14 :     maskTypeList = { EnumConstants::BLUR, EnumConstants::CANNY,</span>
<span class="lineNum">      56 </span>                :            :                      EnumConstants::THRESHOLD, EnumConstants::LABELMASK};
<span class="lineNum">      57 </span>                :<span class="lineCov">         14 :     maskButtonList = {ui-&gt;blur_label, ui-&gt;canny_label, ui-&gt;threshold_label,</span>
<span class="lineNum">      58 </span>                :            :                       ui-&gt;labelmask_label};
<span class="lineNum">      59 </span>                :<span class="lineCov">          7 :     connectFilters();</span>
<span class="lineNum">      60 </span>                :<span class="lineCov">          7 :     qInfo(&quot;Connected Filters&quot;);</span>
<span class="lineNum">      61 </span>                :<span class="lineCov">          7 :     ui-&gt;IdmPhotoViewer-&gt;setFilterControls(filterControl);</span>
<span class="lineNum">      62 </span>                :<span class="lineCov">          7 :     ui-&gt;IdmMaskViewer-&gt;setFilterControls(filterControl);</span>
<span class="lineNum">      63 </span>                :<span class="lineCov">          7 :     newProject = new newproject(this);</span>
<span class="lineNum">      64 </span>                :            : 
<span class="lineNum">      65 </span>                :            : #ifdef WASM_BUILD
<span class="lineNum">      66 </span>                :            :     ui-&gt;actionExport-&gt;setVisible(false);
<span class="lineNum">      67 </span>                :            : #endif
<span class="lineNum">      68 </span>                :<span class="lineCov">          7 :     mainUndoStack = new QUndoStack(this);</span>
<span class="lineNum">      69 </span>                :<span class="lineCov">          7 :     tempUndoStack = new QUndoStack(this);</span>
<span class="lineNum">      70 </span>                :<span class="lineCov">          7 :     undoGroup = new QUndoGroup(this);</span>
<span class="lineNum">      71 </span>                :<span class="lineCov">          7 :     undoGroup-&gt;addStack(mainUndoStack);</span>
<span class="lineNum">      72 </span>                :<span class="lineCov">          7 :     undoGroup-&gt;addStack(tempUndoStack);</span>
<span class="lineNum">      73 </span>                :<span class="lineCov">          7 :     undoGroup-&gt;setActiveStack(mainUndoStack);</span>
<span class="lineNum">      74 </span>                :<span class="lineCov">          7 :     currentSelectType = SelectItem::Ellipse;</span>
<span class="lineNum">      75 </span>                :<span class="lineCov">          7 :     scene = ui-&gt;IdmPhotoViewer-&gt;scene;</span>
<span class="lineNum">      76 </span>                :<span class="lineCov">          7 :     maskScene = ui-&gt;IdmMaskViewer-&gt;scene;</span>
<span class="lineNum">      77 </span>                :            : 
<span class="lineNum">      78 </span>                :<span class="lineCov">          7 :     this-&gt;databaseURL = databaseURL;</span>
<span class="lineNum">      79 </span>                :<span class="lineCov">          7 :     this-&gt;accessToken = token;</span>
<span class="lineNum">      80 </span>                :<span class="lineCov">          7 :     currentItem = nullptr;</span>
<span class="lineNum">      81 </span>                :            :     currentLabel = nullptr;
<span class="lineNum">      82 </span>                :<span class="lineCov">          7 :     currentProject = new Project();</span>
<span class="lineNum">      83 </span>                :            :     connect(scene, SIGNAL(pointClicked(PhotoScene::viewerTypes, SelectItem*,
<span class="lineNum">      84 </span>                :            :                                        QPointF, const Qt::MouseButton)), this,
<span class="lineNum">      85 </span>                :            :             SLOT(processPointClicked(PhotoScene::viewerTypes, SelectItem*,
<span class="lineNum">      86 </span>                :<span class="lineCov">          7 :                                      QPointF, const Qt::MouseButton)));</span>
<span class="lineNum">      87 </span>                :            :     connect(scene, SIGNAL(mouseMoved(QPointF, QPointF)), this,
<span class="lineNum">      88 </span>                :<span class="lineCov">          7 :             SLOT(processMouseMoved(QPointF, QPointF)));</span>
<span class="lineNum">      89 </span>                :            :     connect(scene, SIGNAL(mouseReleased(PhotoScene::viewerTypes, QPointF,
<span class="lineNum">      90 </span>                :            :                                         QPointF, const Qt::MouseButton)), this,
<span class="lineNum">      91 </span>                :            :             SLOT(processMouseReleased(PhotoScene::viewerTypes, QPointF, QPointF,
<span class="lineNum">      92 </span>                :<span class="lineCov">          7 :                                       const Qt::MouseButton)));</span>
<span class="lineNum">      93 </span>                :            :     connect(scene, SIGNAL(keyPressed(PhotoScene::viewerTypes, const int)), this,
<span class="lineNum">      94 </span>                :<span class="lineCov">          7 :             SLOT(processKeyPressed(PhotoScene::viewerTypes, const int)));</span>
<span class="lineNum">      95 </span>                :            :     connect(maskScene, SIGNAL(pointClicked(PhotoScene::viewerTypes, SelectItem*,
<span class="lineNum">      96 </span>                :            :                                            QPointF, const Qt::MouseButton)), this,
<span class="lineNum">      97 </span>                :            :             SLOT(processPointClicked(PhotoScene::viewerTypes, SelectItem*,
<span class="lineNum">      98 </span>                :<span class="lineCov">          7 :                                      QPointF, const Qt::MouseButton)));</span>
<span class="lineNum">      99 </span>                :            :     connect(maskScene, SIGNAL(mouseMoved(QPointF, QPointF)), this,
<span class="lineNum">     100 </span>                :<span class="lineCov">          7 :             SLOT(processMouseMoved(QPointF, QPointF)));</span>
<span class="lineNum">     101 </span>                :            :     connect(maskScene, SIGNAL(mouseReleased(PhotoScene::viewerTypes, QPointF,
<span class="lineNum">     102 </span>                :            :                                             QPointF, const Qt::MouseButton)), this,
<span class="lineNum">     103 </span>                :            :             SLOT(processMouseReleased(PhotoScene::viewerTypes, QPointF, QPointF,
<span class="lineNum">     104 </span>                :<span class="lineCov">          7 :                                       const Qt::MouseButton)));</span>
<span class="lineNum">     105 </span>                :            :     connect(maskScene, SIGNAL(keyPressed(PhotoScene::viewerTypes, const int)), this,
<span class="lineNum">     106 </span>                :<span class="lineCov">          7 :             SLOT(processKeyPressed(PhotoScene::viewerTypes, const int)));</span>
<span class="lineNum">     107 </span>                :            : 
<span class="lineNum">     108 </span>                :            :     connect(ui-&gt;showMaskSelections, SIGNAL(stateChanged(int)), this,
<span class="lineNum">     109 </span>                :<span class="lineCov">          7 :             SLOT(processShowHide(int)));</span>
<span class="lineNum">     110 </span>                :            :     connect(ui-&gt;addSelectionButton, SIGNAL(clicked()), this,
<span class="lineNum">     111 </span>                :<span class="lineCov">          7 :             SLOT(addCurrentSelection()));</span>
<span class="lineNum">     112 </span>                :            :     connect(ui-&gt;cancelSelectionButton, SIGNAL(clicked()), this,
<span class="lineNum">     113 </span>                :<span class="lineCov">          7 :             SLOT(cancelCurrentSelection()));</span>
<span class="lineNum">     114 </span>                :<span class="lineCov">          7 :     undoAction = undoGroup-&gt;createUndoAction(this, tr(&quot;&amp;Undo&quot;));</span>
<span class="lineNum">     115 </span>                :<span class="lineCov">          7 :     undoAction-&gt;setShortcuts(QKeySequence::Undo);</span>
<span class="lineNum">     116 </span>                :<span class="lineCov">          7 :     redoAction = undoGroup-&gt;createRedoAction(this, tr(&quot;&amp;Redo&quot;));</span>
<span class="lineNum">     117 </span>                :<span class="lineCov">          7 :     redoAction-&gt;setShortcuts(QKeySequence::Redo);</span>
<span class="lineNum">     118 </span>                :<span class="lineCov">          7 :     ui-&gt;menuEdit-&gt;addAction(undoAction);</span>
<span class="lineNum">     119 </span>                :<span class="lineCov">          7 :     ui-&gt;menuEdit-&gt;addAction(redoAction);</span>
<span class="lineNum">     120 </span>                :<span class="lineCov">          7 :     blankForm = new Ui::blankForm;</span>
<span class="lineNum">     121 </span>                :<span class="lineCov">          7 :     freeSelectForm = new Ui::freeSelectForm;</span>
<span class="lineNum">     122 </span>                :<span class="lineCov">          7 :     polygonSelectForm = new Ui::polygonSelectForm;</span>
<span class="lineNum">     123 </span>                :<span class="lineCov">          7 :     controlLayout = new QGridLayout(ui-&gt;selectControlFrame);</span>
<span class="lineNum">     124 </span>                :<span class="lineCov">          7 :     blankWidget = new QWidget(ui-&gt;selectControlFrame);</span>
<span class="lineNum">     125 </span>                :<span class="lineCov">          7 :     blankForm-&gt;setupUi(blankWidget);</span>
<span class="lineNum">     126 </span>                :<span class="lineCov">          7 :     freeSelectWidget = new QWidget(ui-&gt;selectControlFrame);</span>
<span class="lineNum">     127 </span>                :<span class="lineCov">          7 :     freeSelectForm-&gt;setupUi(freeSelectWidget);</span>
<span class="lineNum">     128 </span>                :            :     connect(freeSelectForm-&gt;roundBrushButton, SIGNAL(clicked()), this,
<span class="lineNum">     129 </span>                :<span class="lineCov">          7 :             SLOT(roundBrushButtonClicked()));</span>
<span class="lineNum">     130 </span>                :            :     connect(freeSelectForm-&gt;squareBrushButton, SIGNAL(clicked()), this,
<span class="lineNum">     131 </span>                :<span class="lineCov">          7 :             SLOT(squareBrushButtonClicked()));</span>
<span class="lineNum">     132 </span>                :            :     connect(freeSelectForm-&gt;drawButton, SIGNAL(clicked()), this,
<span class="lineNum">     133 </span>                :<span class="lineCov">          7 :             SLOT(toggleDrawing()));</span>
<span class="lineNum">     134 </span>                :<span class="lineCov">          7 :     connect(ui-&gt;panButton, SIGNAL(clicked()), this, SLOT(panButton_clicked()));</span>
<span class="lineNum">     135 </span>                :            :     connect(freeSelectForm-&gt;eraseButton, SIGNAL(clicked()), this,
<span class="lineNum">     136 </span>                :<span class="lineCov">          7 :             SLOT(toggleErasing()));</span>
<span class="lineNum">     137 </span>                :            :     connect(freeSelectForm-&gt;brushSizeSlider, SIGNAL(valueChanged(int)),
<span class="lineNum">     138 </span>                :<span class="lineCov">          7 :             freeSelectForm-&gt;brushSizeSpinner, SLOT(setValue(int)));</span>
<span class="lineNum">     139 </span>                :            :     connect(freeSelectForm-&gt;brushSizeSpinner, SIGNAL(valueChanged(int)),
<span class="lineNum">     140 </span>                :<span class="lineCov">          7 :             freeSelectForm-&gt;brushSizeSlider, SLOT(setValue(int)));</span>
<span class="lineNum">     141 </span>                :            :     connect(freeSelectForm-&gt;brushSizeSlider, SIGNAL(valueChanged(int)), this,
<span class="lineNum">     142 </span>                :<span class="lineCov">          7 :             SLOT(setCurrentBrushSize(int)));</span>
<span class="lineNum">     143 </span>                :<span class="lineCov">          7 :     freeSelectForm-&gt;brushSizeSlider-&gt;setValue(currentBrushSize);</span>
<span class="lineNum">     144 </span>                :<span class="lineCov">          7 :     freeSelectWidget-&gt;hide();</span>
<span class="lineNum">     145 </span>                :<span class="lineCov">          7 :     polygonSelectWidget = new QWidget(ui-&gt;selectControlFrame);</span>
<span class="lineNum">     146 </span>                :<span class="lineCov">          7 :     polygonSelectForm-&gt;setupUi(polygonSelectWidget);</span>
<span class="lineNum">     147 </span>                :            :     connect(polygonSelectForm-&gt;finishPolygonButton, SIGNAL(clicked()), this,
<span class="lineNum">     148 </span>                :<span class="lineCov">          7 :             SLOT(finishPolygonButtonClicked()));</span>
<span class="lineNum">     149 </span>                :            :     connect(polygonSelectForm-&gt;insertPointButton, SIGNAL(clicked()), this,
<span class="lineNum">     150 </span>                :<span class="lineCov">          7 :             SLOT(setInsert()));</span>
<span class="lineNum">     151 </span>                :<span class="lineCov">          7 :     polygonSelectWidget-&gt;hide();</span>
<span class="lineNum">     152 </span>                :<span class="lineCov">          7 :     controlLayout-&gt;addWidget(blankWidget);</span>
<span class="lineNum">     153 </span>                :            : #ifndef TEST
<span class="lineNum">     154 </span>                :            :     StartingWidget *sw = new StartingWidget;
<span class="lineNum">     155 </span>                :            :     sw-&gt;show();
<span class="lineNum">     156 </span>                :            : #endif
<span class="lineNum">     157 </span>                :            : 
<span class="lineNum">     158 </span>                :            : #ifdef WASM_BUILD
<span class="lineNum">     159 </span>                :            :     addImageConnector(&quot;Load File&quot;, [&amp;]() {
<span class="lineNum">     160 </span>                :            :             QHtml5File::load(&quot;.jpg, .png&quot;, [&amp;](const QByteArray &amp;content, const QString &amp;fileName) {
<span class="lineNum">     161 </span>                :            :                 imageFileContent = content;
<span class="lineNum">     162 </span>                :            :                 this-&gt;filename = fileName;
<span class="lineNum">     163 </span>                :            :                 imagesList = (QStringList() &lt;&lt; filename);
<span class="lineNum">     164 </span>                :            :                 openFile_and_labels();
<span class="lineNum">     165 </span>                :            :             });
<span class="lineNum">     166 </span>                :            :         });
<span class="lineNum">     167 </span>                :            : 
<span class="lineNum">     168 </span>                :            :     addIdproConnector(&quot;Load File&quot;, [&amp;]() {
<span class="lineNum">     169 </span>                :            :             QHtml5File::load(&quot;.idpro&quot;, [&amp;](const QByteArray &amp;content, const QString &amp;fileName) {
<span class="lineNum">     170 </span>                :            :                 idproFileContent = content;
<span class="lineNum">     171 </span>                :            :                 idproFileName = fileName;
<span class="lineNum">     172 </span>                :            :                 loadLabelFile(idproFileName);
<span class="lineNum">     173 </span>                :            :             });
<span class="lineNum">     174 </span>                :            :         });
<span class="lineNum">     175 </span>                :            : 
<span class="lineNum">     176 </span>                :            : #endif
<span class="lineNum">     177 </span>                :<span class="lineCov">          7 : }</span>
<span class="lineNum">     178 </span>                :            : 
<span class="lineNum">     179 </span>                :            : #ifdef WASM_BUILD
<span class="lineNum">     180 </span>                :            : void InstaDam::addImageConnector(QString text, std::function&lt;void ()&gt; onActivate) {
<span class="lineNum">     181 </span>                :            :     openImageConnector = new MyConnector;
<span class="lineNum">     182 </span>                :            :     openImageConnector-&gt;onActivate = onActivate;
<span class="lineNum">     183 </span>                :            : }
<span class="lineNum">     184 </span>                :            : 
<span class="lineNum">     185 </span>                :            : void InstaDam::addIdproConnector(QString text, std::function&lt;void ()&gt; onActivate) {
<span class="lineNum">     186 </span>                :            :     openIdproConnector = new MyConnector;
<span class="lineNum">     187 </span>                :            :     openIdproConnector-&gt;onActivate = onActivate;
<span class="lineNum">     188 </span>                :            : }
<span class="lineNum">     189 </span>                :            : 
<span class="lineNum">     190 </span>                :            : #endif
<span class="lineNum">     191 </span>                :            : 
<span class="lineNum">     192 </span>                :            : /*!
<a name="193"><span class="lineNum">     193 </span>                :            :   Destructor</a>
<span class="lineNum">     194 </span>                :            :   */
<span class="lineNum">     195 </span>                :<span class="lineCov">         35 : InstaDam::~InstaDam() {</span>
<span class="lineNum">     196 </span>                :<span class="lineCov">          7 :     delete ui;</span>
<span class="lineNum">     197 </span>                :<span class="lineCov">         14 : }</span>
<span class="lineNum">     198 </span>                :            : 
<span class="lineNum">     199 </span>                :            : /*!
<a name="200"><span class="lineNum">     200 </span>                :            :   Sets the current project to the newly created project.</a>
<span class="lineNum">     201 </span>                :            :   */
<span class="lineNum">     202 </span>                :<span class="lineCov">          3 : void InstaDam::setNewProject() {</span>
<span class="lineNum">     203 </span>                :<span class="lineCov">          3 :     currentProject = newProject-&gt;newPr;</span>
<span class="lineNum">     204 </span>                :<span class="lineCov">          3 :     setLabels();</span>
<span class="lineNum">     205 </span>                :<span class="lineCov">          3 :     scene-&gt;clearItems();</span>
<span class="lineNum">     206 </span>                :<span class="lineCov">          3 :     maskScene-&gt;clearItems();</span>
<span class="lineNum">     207 </span>                :<span class="lineCov">          3 : }</span>
<span class="lineNum">     208 </span>                :            : 
<span class="lineNum">     209 </span>                :            : /*!
<a name="210"><span class="lineNum">     210 </span>                :            :   Creates sets the label buttons to the labels of the current project.</a>
<span class="lineNum">     211 </span>                :            :   */
<span class="lineNum">     212 </span>                :<span class="lineCov">          6 : void InstaDam::setLabels() {</span>
<span class="lineNum">     213 </span>                :<span class="lineCov">          6 :     clearLayout(ui-&gt;labelClassLayout);</span>
<span class="lineNum">     214 </span>                :<span class="lineCov">          6 :     labelButtons.clear();</span>
<span class="lineNum">     215 </span>                :<span class="lineCov">         21 :     for (int i = 0; i &lt; currentProject-&gt;numLabels(); i++) {</span>
<span class="lineNum">     216 </span>                :<span class="lineCov">         15 :         QSharedPointer&lt;Label&gt; label = currentProject-&gt;getLabel(i);</span>
<span class="lineNum">     217 </span>                :<span class="lineCov">         30 :         LabelButton *button = new LabelButton(label);</span>
<span class="lineNum">     218 </span>                :<span class="lineCov">         15 :         button-&gt;setText(label-&gt;getText());</span>
<span class="lineNum">     219 </span>                :<span class="lineCov">         30 :         QPalette pal = button-&gt;palette();</span>
<span class="lineNum">     220 </span>                :<span class="lineCov">         30 :         pal.setColor(QPalette::ButtonText, Qt::black);</span>
<span class="lineNum">     221 </span>                :<span class="lineCov">         30 :         pal.setColor(QPalette::Button, label-&gt;getColor());</span>
<span class="lineNum">     222 </span>                :<span class="lineCov">         15 :         button-&gt;setAutoFillBackground(true);</span>
<span class="lineNum">     223 </span>                :<span class="lineCov">         15 :         button-&gt;setPalette(pal);</span>
<span class="lineNum">     224 </span>                :<span class="lineCov">         15 :         button-&gt;update();</span>
<span class="lineNum">     225 </span>                :<span class="lineCov">         15 :         QHBoxLayout *hl = new QHBoxLayout();</span>
<span class="lineNum">     226 </span>                :<span class="lineCov">         15 :         hl-&gt;addWidget(button-&gt;slider);</span>
<span class="lineNum">     227 </span>                :<span class="lineCov">         15 :         hl-&gt;addWidget(button);</span>
<span class="lineNum">     228 </span>                :<span class="lineCov">         15 :         ui-&gt;labelClassLayout-&gt;addLayout(hl);</span>
<span class="lineNum">     229 </span>                :            :         connect(button, SIGNAL(cclicked(QSharedPointer&lt;Label&gt;)), this,
<span class="lineNum">     230 </span>                :<span class="lineCov">         15 :                 SLOT(setCurrentLabel(QSharedPointer&lt;Label&gt;)));</span>
<span class="lineNum">     231 </span>                :<span class="lineCov">         15 :         button-&gt;slider-&gt;setValue(50);</span>
<span class="lineNum">     232 </span>                :            :         connect(button, SIGNAL(opacity(QSharedPointer&lt;Label&gt;, int)), this,
<span class="lineNum">     233 </span>                :<span class="lineCov">         15 :                 SLOT(setOpacity(QSharedPointer&lt;Label&gt;, int)));</span>
<span class="lineNum">     234 </span>                :            : 
<span class="lineNum">     235 </span>                :            :         labelButtons.push_back(button);
<span class="lineNum">     236 </span>                :            :     }
<span class="lineNum">     237 </span>                :<span class="lineCov">          6 : }</span>
<span class="lineNum">     238 </span>                :            : 
<span class="lineNum">     239 </span>                :            : /*!
<a name="240"><span class="lineNum">     240 </span>                :            :  Creates a new project.</a>
<span class="lineNum">     241 </span>                :            :   */
<span class="lineNum">     242 </span>                :<span class="lineCov">          3 : void InstaDam::on_actionNew_triggered() {</span>
<span class="lineNum">     243 </span>                :<span class="lineCov">          3 :     currentProject-&gt;resetLabels();</span>
<span class="lineNum">     244 </span>                :<span class="lineCov">          3 :     newProject = new newproject(this);</span>
<span class="lineNum">     245 </span>                :            : #ifndef TEST
<span class="lineNum">     246 </span>                :            :     newProject-&gt;setModal(true);
<span class="lineNum">     247 </span>                :            :     connect(newProject, SIGNAL(accepted()), this, SLOT(setNewProject()));
<span class="lineNum">     248 </span>                :            :     newProject-&gt;exec();
<span class="lineNum">     249 </span>                :            : #else
<span class="lineNum">     250 </span>                :<span class="lineCov">          3 :     QHashIterator&lt;QString, QColor&gt; it(labelHash);</span>
<span class="lineNum">     251 </span>                :<span class="lineCov">         12 :     while (it.hasNext()) {</span>
<span class="lineNum">     252 </span>                :            :         it.next();
<span class="lineNum">     253 </span>                :<span class="lineCov">          9 :         newProject-&gt;setLabel(it.key(), it.value());</span>
<span class="lineNum">     254 </span>                :            :     }
<span class="lineNum">     255 </span>                :            : #endif
<span class="lineNum">     256 </span>                :<span class="lineCov">          3 :     setNewProject();</span>
<span class="lineNum">     257 </span>                :<span class="lineCov">          3 : }</span>
<span class="lineNum">     258 </span>                :            : 
<span class="lineNum">     259 </span>                :            : /*!
<a name="260"><span class="lineNum">     260 </span>                :            :  Sets the \a currentLabel to the \a myLabel of the LabelButton \a button</a>
<span class="lineNum">     261 </span>                :            :   */
<span class="lineNum">     262 </span>                :<span class="lineNoCov">          0 : void InstaDam::setCurrentLabel(LabelButton *button) {</span>
<span class="lineNum">     263 </span>                :<span class="lineNoCov">          0 :     currentLabel = button-&gt;myLabel;</span>
<span class="lineNum">     264 </span>                :<span class="lineNoCov">          0 : }</span>
<span class="lineNum">     265 </span>                :            : 
<span class="lineNum">     266 </span>                :            : /*!
<a name="267"><span class="lineNum">     267 </span>                :            :  Sets the \a currentLabel to the Label \a label</a>
<span class="lineNum">     268 </span>                :            :   */
<span class="lineNum">     269 </span>                :<span class="lineCov">          9 : void InstaDam::setCurrentLabel(QSharedPointer&lt;Label&gt; label) {</span>
<span class="lineNum">     270 </span>                :<span class="lineCov">          9 :     if (currentLabel == label)</span>
<span class="lineNum">     271 </span>                :<span class="lineCov">          9 :         return;</span>
<span class="lineNum">     272 </span>                :<span class="lineCov">         63 :     for (int i = 0; i &lt; labelButtons.size(); i++) {</span>
<span class="lineNum">     273 </span>                :<span class="lineCov">         81 :         if (label != labelButtons[i]-&gt;myLabel) {</span>
<span class="lineNum">     274 </span>                :<span class="lineCov">         18 :             labelButtons[i]-&gt;setChecked(false);</span>
<span class="lineNum">     275 </span>                :            :         } else {
<span class="lineNum">     276 </span>                :<span class="lineCov">          9 :             labelButtons[i]-&gt;setChecked(true);</span>
<span class="lineNum">     277 </span>                :            :         }
<span class="lineNum">     278 </span>                :            :     }
<span class="lineNum">     279 </span>                :<span class="lineCov">          9 :     currentLabel = label;</span>
<span class="lineNum">     280 </span>                :<span class="lineCov">          9 :     cancelCurrentSelection();</span>
<span class="lineNum">     281 </span>                :            : }
<span class="lineNum">     282 </span>                :            : 
<span class="lineNum">     283 </span>                :            : /*!
<a name="284"><span class="lineNum">     284 </span>                :            :  Sets the opacity of the Label \a label to \a val.</a>
<span class="lineNum">     285 </span>                :            :   */
<span class="lineNum">     286 </span>                :<span class="lineNoCov">          0 : void InstaDam::setOpacity(QSharedPointer&lt;Label&gt; label, int val) {</span>
<span class="lineNum">     287 </span>                :<span class="lineNoCov">          0 :     qInfo(&quot;Instadam Opacity&quot;);</span>
<span class="lineNum">     288 </span>                :<span class="lineNoCov">          0 :     label-&gt;setOpacity(val);</span>
<span class="lineNum">     289 </span>                :<span class="lineNoCov">          0 :     scene-&gt;update();</span>
<span class="lineNum">     290 </span>                :<span class="lineNoCov">          0 :     maskScene-&gt;update();</span>
<span class="lineNum">     291 </span>                :<span class="lineNoCov">          0 : }</span>
<span class="lineNum">     292 </span>                :            : 
<span class="lineNum">     293 </span>                :            : 
<span class="lineNum">     294 </span>                :            : /*!
<a name="295"><span class="lineNum">     295 </span>                :            :  Removes all items from the QLayout \a layout.</a>
<span class="lineNum">     296 </span>                :            :   */
<span class="lineNum">     297 </span>                :<span class="lineCov">          8 : void InstaDam::clearLayout(QLayout *layout) {</span>
<span class="lineNum">     298 </span>                :<span class="lineCov">          8 :     if (!layout)</span>
<span class="lineNum">     299 </span>                :<span class="lineCov">          8 :        return;</span>
<span class="lineNum">     300 </span>                :            : 
<span class="lineNum">     301 </span>                :<span class="lineCov">          8 :     while (auto item = layout-&gt;takeAt(0)) {</span>
<span class="lineNum">     302 </span>                :<span class="lineNoCov">          0 :         if (item) {</span>
<span class="lineNum">     303 </span>                :<span class="lineNoCov">          0 :             delete item-&gt;widget();</span>
<span class="lineNum">     304 </span>                :<span class="lineNoCov">          0 :             clearLayout(item-&gt;layout());</span>
<span class="lineNum">     305 </span>                :<span class="lineNoCov">          0 :             layout-&gt;removeItem(item);</span>
<span class="lineNum">     306 </span>                :            :         }
<span class="lineNum">     307 </span>                :            :     }
<span class="lineNum">     308 </span>                :            : }
<span class="lineNum">     309 </span>                :            : 
<span class="lineNum">     310 </span>                :            : 
<span class="lineNum">     311 </span>                :            : /*!
<a name="312"><span class="lineNum">     312 </span>                :            :  Slot for opening a project file (.idpro).</a>
<span class="lineNum">     313 </span>                :            :   */
<span class="lineNum">     314 </span>                :<span class="lineCov">          1 : void InstaDam::on_actionOpen_triggered() {</span>
<span class="lineNum">     315 </span>                :            : #ifdef WASM_BUILD
<span class="lineNum">     316 </span>                :            :       openIdproConnector-&gt;onActivate();
<span class="lineNum">     317 </span>                :            : #else
<span class="lineNum">     318 </span>                :            : #ifndef TEST
<span class="lineNum">     319 </span>                :            :     // Reading and Loading
<span class="lineNum">     320 </span>                :            :     QString myfileName = QFileDialog::getOpenFileName(this,
<span class="lineNum">     321 </span>                :            :         tr(&quot;Open Project&quot;), &quot;../&quot;, tr(&quot;Instadam Project (*.idpro);; All Files (*)&quot;));
<span class="lineNum">     322 </span>                :            : #else
<span class="lineNum">     323 </span>                :            :     QString myfileName = prjInName;
<span class="lineNum">     324 </span>                :            : #endif
<span class="lineNum">     325 </span>                :<span class="lineCov">          1 :     if (myfileName.isEmpty()) {</span>
<span class="lineNum">     326 </span>                :<span class="lineNoCov">          0 :             return;  // remove that part and add an alert</span>
<span class="lineNum">     327 </span>                :            :     } else {
<span class="lineNum">     328 </span>                :            : 
<span class="lineNum">     329 </span>                :<span class="lineCov">          1 :         loadLabelFile(myfileName, PROJECT);</span>
<span class="lineNum">     330 </span>                :<span class="lineCov">          1 :         mainUndoStack-&gt;clear();</span>
<span class="lineNum">     331 </span>                :<span class="lineCov">          1 :         tempUndoStack-&gt;clear();</span>
<span class="lineNum">     332 </span>                :<span class="lineCov">          1 :         undoGroup-&gt;setActiveStack(mainUndoStack);</span>
<span class="lineNum">     333 </span>                :<span class="lineCov">          1 :         scene-&gt;clearItems();</span>
<span class="lineNum">     334 </span>                :<span class="lineCov">          1 :         maskScene-&gt;clearItems();</span>
<span class="lineNum">     335 </span>                :<span class="lineCov">          1 :         scene-&gt;update();</span>
<span class="lineNum">     336 </span>                :<span class="lineCov">          1 :         maskScene-&gt;update();</span>
<span class="lineNum">     337 </span>                :<span class="lineCov">          1 :     }</span>
<span class="lineNum">     338 </span>                :            : #endif
<span class="lineNum">     339 </span>                :            : }
<span class="lineNum">     340 </span>                :            : 
<span class="lineNum">     341 </span>                :            : /*!
<a name="342"><span class="lineNum">     342 </span>                :            :  Toggles the mouse funciton for freeDrawSelect to drawing and not erasing.</a>
<span class="lineNum">     343 </span>                :            :   */
<span class="lineNum">     344 </span>                :<span class="lineCov">          4 : void InstaDam::toggleDrawing() {</span>
<span class="lineNum">     345 </span>                :<span class="lineCov">          4 :     drawing = true;</span>
<span class="lineNum">     346 </span>                :<span class="lineCov">          4 :     freeSelectForm-&gt;eraseButton-&gt;setChecked(false);</span>
<span class="lineNum">     347 </span>                :<span class="lineCov">          4 :     freeSelectForm-&gt;drawButton-&gt;setChecked(true);</span>
<span class="lineNum">     348 </span>                :<span class="lineCov">          4 : }</span>
<span class="lineNum">     349 </span>                :            : 
<span class="lineNum">     350 </span>                :            : /*!
<a name="351"><span class="lineNum">     351 </span>                :            :  Toggles the mouse funciton for freeDrawSelect to erasing and not drawing.</a>
<span class="lineNum">     352 </span>                :            :   */
<span class="lineNum">     353 </span>                :<span class="lineCov">          4 : void InstaDam::toggleErasing() {</span>
<span class="lineNum">     354 </span>                :<span class="lineCov">          4 :     drawing = false;</span>
<span class="lineNum">     355 </span>                :<span class="lineCov">          4 :     freeSelectForm-&gt;eraseButton-&gt;setChecked(true);</span>
<span class="lineNum">     356 </span>                :<span class="lineCov">          4 :     freeSelectForm-&gt;drawButton-&gt;setChecked(false);</span>
<span class="lineNum">     357 </span>                :<span class="lineCov">          4 : }</span>
<span class="lineNum">     358 </span>                :            : 
<span class="lineNum">     359 </span>                :            : /*!
<span class="lineNum">     360 </span>                :            :  Connects the filter buttons to the corresponding maskType.
<span class="lineNum">     361 </span>                :            :   */
<span class="lineNum">     362 </span>                :<span class="lineCov">          7 : void InstaDam::connectFilters() {</span>
<span class="lineNum">     363 </span>                :<span class="lineCov">         70 :     for (int i = 0; i &lt; maskButtonList.size(); ++i) {</span>
<span class="lineNum">     364 </span>                :<span class="lineCov">        252 :         for (int j = 0; j &lt; maskButtonList.size(); ++j) {</span>
<span class="lineNum">     365 </span>                :<span class="lineCov">        112 :             if (i == j) {</span>
<span class="lineNum">     366 </span>                :<span class="lineCov">         84 :                 maskButtonList[i]-&gt;setMaskType(maskTypeList[i]);</span>
<span class="lineNum">     367 </span>                :            :                 connect(maskButtonList[i], SIGNAL(checked(EnumConstants::maskTypes)),
<span class="lineNum">     368 </span>                :<span class="lineCov">         56 :                         ui-&gt;IdmPhotoViewer, SLOT(setImMask(EnumConstants::maskTypes)));</span>
<span class="lineNum">     369 </span>                :            :             } else {
<span class="lineNum">     370 </span>                :            :                 connect(maskButtonList[i], SIGNAL(checked(EnumConstants::maskTypes)),
<span class="lineNum">     371 </span>                :<span class="lineCov">        252 :                         maskButtonList[j], SLOT(otherBoxChecked(EnumConstants::maskTypes)));</span>
<span class="lineNum">     372 </span>                :            :             }
<span class="lineNum">     373 </span>                :            :         }
<span class="lineNum">     374 </span>                :            :     }
<span class="lineNum">     375 </span>                :            :     connect(ui-&gt;IdmPhotoViewer, SIGNAL(changedMask(EnumConstants::maskTypes)),
<span class="lineNum">     376 </span>                :<span class="lineCov">          7 :             ui-&gt;IdmMaskViewer, SLOT(setImMask(EnumConstants::maskTypes)));</span>
<span class="lineNum">     377 </span>                :            :     connect(ui-&gt;IdmPhotoViewer, SIGNAL(zoomed(int, float, QPointF)),
<span class="lineNum">     378 </span>                :<span class="lineCov">          7 :             ui-&gt;IdmMaskViewer, SLOT(zoomedInADifferentView(int, float, QPointF)));</span>
<span class="lineNum">     379 </span>                :            :     connect(ui-&gt;IdmMaskViewer, SIGNAL(zoomed(int, float, QPointF)),
<span class="lineNum">     380 </span>                :<span class="lineCov">          7 :             ui-&gt;IdmPhotoViewer, SLOT(zoomedInADifferentView(int, float, QPointF)));</span>
<span class="lineNum">     381 </span>                :            :     connect(ui-&gt;IdmPhotoViewer, SIGNAL(loadedPhoto()), this,
<span class="lineNum">     382 </span>                :<span class="lineCov">          7 :             SLOT(resetPixmapButtons()));</span>
<span class="lineNum">     383 </span>                :<span class="lineCov">          7 : }</span>
<span class="lineNum">     384 </span>                :            : 
<span class="lineNum">     385 </span>                :            : /*!
<span class="lineNum">     386 </span>                :            :  Resets the pixmaps of the filter buttons.
<span class="lineNum">     387 </span>                :            :   */
<span class="lineNum">     388 </span>                :<span class="lineCov">          4 : void InstaDam::resetPixmapButtons() {</span>
<span class="lineNum">     389 </span>                :<span class="lineCov">          4 :     cv::Mat thumbnail = ui-&gt;IdmPhotoViewer-&gt;cvThumb;</span>
<span class="lineNum">     390 </span>                :<span class="lineCov">         36 :     for (int i = 0; i &lt; maskButtonList.size(); ++i) {</span>
<span class="lineNum">     391 </span>                :<span class="lineCov">         48 :          maskButtonList[i]-&gt;resetPixmaps(filterControl-&gt;thumb2pixmap(thumbnail, maskTypeList[i]));</span>
<span class="lineNum">     392 </span>                :<span class="lineCov">          4 :     }</span>
<span class="lineNum">     393 </span>                :<span class="lineCov">          4 : }</span>
<span class="lineNum">     394 </span>                :            : 
<span class="lineNum">     395 </span>                :            : /*!
<a name="396"><span class="lineNum">     396 </span>                :            :  Sets the current freedrawselect brush size to \a size.</a>
<span class="lineNum">     397 </span>                :            :   */
<span class="lineNum">     398 </span>                :<span class="lineCov">         11 : void InstaDam::setCurrentBrushSize(int size) {</span>
<span class="lineNum">     399 </span>                :<span class="lineCov">         11 :     currentBrushSize = size;</span>
<span class="lineNum">     400 </span>                :<span class="lineCov">         11 : }</span>
<span class="lineNum">     401 </span>                :            : 
<span class="lineNum">     402 </span>                :            : /*!
<a name="403"><span class="lineNum">     403 </span>                :            :  Saves the current annotation to disk or the server.</a>
<span class="lineNum">     404 </span>                :            :   */
<span class="lineNum">     405 </span>                :<span class="lineCov">          1 : void InstaDam::on_actionSave_Annotation_triggered() {</span>
<span class="lineNum">     406 </span>                :            :     // Saving the file
<span class="lineNum">     407 </span>                :            :     #ifdef WASM_BUILD
<span class="lineNum">     408 </span>                :            :         QByteArray outFile;
<span class="lineNum">     409 </span>                :            :     #else
<span class="lineNum">     410 </span>                :            :         QString outFileName = this-&gt;annotationPath;
<span class="lineNum">     411 </span>                :            : 
<span class="lineNum">     412 </span>                :<span class="lineCov">          2 :         QFile outFile(outFileName);</span>
<span class="lineNum">     413 </span>                :<span class="lineCov">          1 :         outFile.open(QIODevice::WriteOnly);</span>
<span class="lineNum">     414 </span>                :            :     #endif
<span class="lineNum">     415 </span>                :<span class="lineCov">          2 :         QJsonObject json;</span>
<span class="lineNum">     416 </span>                :<span class="lineCov">          1 :         write(json, ANNOTATION);</span>
<span class="lineNum">     417 </span>                :<span class="lineCov">          2 :         QJsonDocument saveDoc(json);</span>
<span class="lineNum">     418 </span>                :            :     #ifdef WASM_BUILD
<span class="lineNum">     419 </span>                :            :         QString strJson(saveDoc.toJson(QJsonDocument::Compact));
<span class="lineNum">     420 </span>                :            :         outFile.append(strJson);
<span class="lineNum">     421 </span>                :            :         QHtml5File::save(outFile, &quot;myproject.idantn&quot;);
<span class="lineNum">     422 </span>                :            : 
<span class="lineNum">     423 </span>                :            :     #else
<span class="lineNum">     424 </span>                :<span class="lineCov">          2 :         outFile.write(saveDoc.toJson(QJsonDocument::Compact));</span>
<span class="lineNum">     425 </span>                :            :     #endif
<span class="lineNum">     426 </span>                :<span class="lineCov">          1 : }</span>
<span class="lineNum">     427 </span>                :            : 
<span class="lineNum">     428 </span>                :            : /*!
<a name="429"><span class="lineNum">     429 </span>                :            :  Saves the current project to disk or the server.</a>
<span class="lineNum">     430 </span>                :            :   */
<span class="lineNum">     431 </span>                :<span class="lineCov">          1 : void InstaDam::on_actionSave_triggered() {</span>
<span class="lineNum">     432 </span>                :            :     // Saving the file
<span class="lineNum">     433 </span>                :            : #ifdef WASM_BUILD
<span class="lineNum">     434 </span>                :            :     QByteArray outFile;
<span class="lineNum">     435 </span>                :            : #else  // WASM_BUILD
<span class="lineNum">     436 </span>                :            : #ifndef TEST
<span class="lineNum">     437 </span>                :            :     QString outFileName = QFileDialog::getSaveFileName(this,
<span class="lineNum">     438 </span>                :            :        tr(&quot;Save Project&quot;), &quot;../&quot;, tr(&quot;Instadam Project (*.idpro);; All Files (*)&quot;));
<span class="lineNum">     439 </span>                :            : #else  // TEST
<span class="lineNum">     440 </span>                :            :     QString outFileName = prjOutName;
<span class="lineNum">     441 </span>                :            : #endif  // TEST
<span class="lineNum">     442 </span>                :<span class="lineCov">          2 :     if (QFileInfo(outFileName).suffix() != QString(&quot;idpro&quot;))</span>
<span class="lineNum">     443 </span>                :<span class="lineNoCov">          0 :         outFileName = outFileName +QString(&quot;.idpro&quot;);</span>
<span class="lineNum">     444 </span>                :            : 
<span class="lineNum">     445 </span>                :<span class="lineCov">          2 :     QFile outFile(outFileName);</span>
<span class="lineNum">     446 </span>                :<span class="lineCov">          1 :     outFile.open(QIODevice::WriteOnly);</span>
<span class="lineNum">     447 </span>                :            : #endif  // WASM_BUILD
<span class="lineNum">     448 </span>                :<span class="lineCov">          2 :     QJsonObject json;</span>
<span class="lineNum">     449 </span>                :<span class="lineCov">          1 :     write(json, PROJECT);</span>
<span class="lineNum">     450 </span>                :<span class="lineCov">          2 :     QJsonDocument saveDoc(json);</span>
<span class="lineNum">     451 </span>                :            : #ifdef WASM_BUILD
<span class="lineNum">     452 </span>                :            :     QString strJson(saveDoc.toJson(QJsonDocument::Compact));
<span class="lineNum">     453 </span>                :            :     outFile.append(strJson);
<span class="lineNum">     454 </span>                :            :     QHtml5File::save(outFile, &quot;myproject.idpro&quot;);
<span class="lineNum">     455 </span>                :            : 
<span class="lineNum">     456 </span>                :            : #else  // WASM_BUILD
<span class="lineNum">     457 </span>                :<span class="lineCov">          2 :     outFile.write(saveDoc.toJson());</span>
<span class="lineNum">     458 </span>                :            : #endif  // WASM_BUILD
<span class="lineNum">     459 </span>                :<span class="lineCov">          1 : }</span>
<span class="lineNum">     460 </span>                :            : 
<span class="lineNum">     461 </span>                :            : /*!
<span class="lineNum">     462 </span>                :            :  Opens a file stored at Qstring \a path for the web-assembly version.
<span class="lineNum">     463 </span>                :            :   */
<span class="lineNum">     464 </span>                :<span class="lineNoCov">          0 : void InstaDam::fileDownloaded(QString path) {</span>
<span class="lineNum">     465 </span>                :<span class="lineNoCov">          0 :     this-&gt;oldFilename = this-&gt;filename;</span>
<span class="lineNum">     466 </span>                :<span class="lineNoCov">          0 :     this-&gt;filename = path;</span>
<span class="lineNum">     467 </span>                :<span class="lineNoCov">          0 :     this-&gt;oldFile = this-&gt;file;</span>
<span class="lineNum">     468 </span>                :<span class="lineNoCov">          0 :     this-&gt;file = QFileInfo(filename);</span>
<span class="lineNum">     469 </span>                :<span class="lineNoCov">          0 :     this-&gt;oldPath = this-&gt;path;</span>
<span class="lineNum">     470 </span>                :<span class="lineNoCov">          0 :     this-&gt;path = file.dir();</span>
<span class="lineNum">     471 </span>                :            :     this-&gt;oldImagesList = this-&gt;imagesList;
<span class="lineNum">     472 </span>                :<span class="lineNoCov">          0 :     this-&gt;imagesList = this-&gt;path.entryList(QStringList() &lt;&lt; &quot;*.jpg&quot; &lt;&lt; &quot;*.JPG&quot; &lt;&lt; &quot;*.png&quot; &lt;&lt; &quot;*.PNG&quot; &lt;&lt; &quot;*.JPEG&quot;, QDir::Files);</span>
<span class="lineNum">     473 </span>                :<span class="lineNoCov">          0 :     if (imagesList.empty()) {</span>
<span class="lineNum">     474 </span>                :<span class="lineNoCov">          0 :         assertError(&quot;That doesn't seem to be a valid image file.&quot;);</span>
<span class="lineNum">     475 </span>                :<span class="lineNoCov">          0 :         revert();</span>
<span class="lineNum">     476 </span>                :            :     } else {
<span class="lineNum">     477 </span>                :            :         int counter = 0;
<span class="lineNum">     478 </span>                :            : 
<span class="lineNum">     479 </span>                :<span class="lineNoCov">          0 :         foreach(QString tempFilename, imagesList) {</span>
<span class="lineNum">     480 </span>                :<span class="lineNoCov">          0 :            QFileInfo tempInfo = QFileInfo(tempFilename);</span>
<span class="lineNum">     481 </span>                :<span class="lineNoCov">          0 :                if (file.completeBaseName() == tempInfo.completeBaseName()) {</span>
<span class="lineNum">     482 </span>                :            :                    break;
<span class="lineNum">     483 </span>                :            :                }
<span class="lineNum">     484 </span>                :<span class="lineNoCov">          0 :               counter++;</span>
<span class="lineNum">     485 </span>                :<span class="lineNoCov">          0 :             }</span>
<span class="lineNum">     486 </span>                :<span class="lineNoCov">          0 :         fileId = counter;</span>
<span class="lineNum">     487 </span>                :            : 
<span class="lineNum">     488 </span>                :<span class="lineNoCov">          0 :         openFile_and_labels();</span>
<span class="lineNum">     489 </span>                :<span class="lineNoCov">          0 :         QTextStream(stdout) &lt;&lt; currentProject-&gt;numLabels() &lt;&lt; &quot;\n&quot;;</span>
<span class="lineNum">     490 </span>                :            :     }
<span class="lineNum">     491 </span>                :<span class="lineNoCov">          0 : }</span>
<span class="lineNum">     492 </span>                :            : 
<span class="lineNum">     493 </span>                :            : /*!
<a name="494"><span class="lineNum">     494 </span>                :            :  Waits for the reply for image reception.</a>
<span class="lineNum">     495 </span>                :            :   */
<span class="lineNum">     496 </span>                :<span class="lineNoCov">          0 : void InstaDam::imagesReplyFinished() {</span>
<span class="lineNum">     497 </span>                :<span class="lineNoCov">          0 :     qInfo() &lt;&lt; &quot;Reply received:&quot;;</span>
<span class="lineNum">     498 </span>                :<span class="lineNoCov">          0 :     QByteArray strReply = rep-&gt;readAll();</span>
<span class="lineNum">     499 </span>                :            :     QJsonParseError jsonError;
<span class="lineNum">     500 </span>                :<span class="lineNoCov">          0 :     QJsonDocument jsonReply = QJsonDocument::fromJson(strReply, &amp;jsonError);  // parse and capture the error flag</span>
<span class="lineNum">     501 </span>                :            : 
<span class="lineNum">     502 </span>                :<span class="lineNoCov">          0 :       if (jsonError.error != QJsonParseError::NoError) {</span>
<span class="lineNum">     503 </span>                :<span class="lineNoCov">          0 :             qInfo() &lt;&lt; &quot;Error: &quot; &lt;&lt; jsonError.errorString();</span>
<span class="lineNum">     504 </span>                :            :       } else {
<span class="lineNum">     505 </span>                :<span class="lineNoCov">          0 :           QJsonObject obj = jsonReply.object();</span>
<span class="lineNum">     506 </span>                :<span class="lineNoCov">          0 :           ImageList* il = new ImageList(nullptr, this-&gt;databaseURL, this-&gt;accessToken);</span>
<span class="lineNum">     507 </span>                :<span class="lineNoCov">          0 :           il-&gt;show();</span>
<span class="lineNum">     508 </span>                :<span class="lineNoCov">          0 :           il-&gt;addItems(obj);</span>
<span class="lineNum">     509 </span>                :<span class="lineNoCov">          0 :           qInfo() &lt;&lt; connect(il, &amp;ImageList::fileDownloaded, this, &amp;InstaDam::fileDownloaded);</span>
<span class="lineNum">     510 </span>                :<span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     511 </span>                :<span class="lineNoCov">          0 : }</span>
<span class="lineNum">     512 </span>                :            : 
<span class="lineNum">     513 </span>                :            : /*!
<span class="lineNum">     514 </span>                :            :  Opens an image and annotation file from the disk or server.
<span class="lineNum">     515 </span>                :            :   */
<span class="lineNum">     516 </span>                :<span class="lineCov">          4 : void InstaDam::on_actionOpen_File_triggered() {</span>
<span class="lineNum">     517 </span>                :<span class="lineCov">          4 :     if (runningLocally) {</span>
<span class="lineNum">     518 </span>                :            :         // QTextStream(stdout)&lt;&lt;currentProject-&gt;numLabels()&lt;&lt;&quot;\n&quot;;
<span class="lineNum">     519 </span>                :            : #ifdef WASM_BUILD
<span class="lineNum">     520 </span>                :            :         if (currentProject-&gt;numLabels() == 0) {
<span class="lineNum">     521 </span>                :            :             assertError(&quot;Please create or open a project first. Projects define the label classes and the color to annotate them. You can open or create a project from the Project menu.&quot;);
<span class="lineNum">     522 </span>                :            :             return;
<span class="lineNum">     523 </span>                :            :         }
<span class="lineNum">     524 </span>                :            :         openImageConnector-&gt;onActivate();
<span class="lineNum">     525 </span>                :            : #else
<span class="lineNum">     526 </span>                :            : 
<span class="lineNum">     527 </span>                :            : #ifndef TEST
<span class="lineNum">     528 </span>                :            :         QString filename_temp = QFileDialog::getOpenFileName(this,
<span class="lineNum">     529 </span>                :            :             tr(&quot;Open Image&quot;), &quot;../&quot;, tr(&quot;Image Files (*.jpg *.png *.JPG *PNG *jpeg *JPEG );; All Files (*)&quot;));
<span class="lineNum">     530 </span>                :            : #else
<span class="lineNum">     531 </span>                :            :         QString filename_temp = imgInName;
<span class="lineNum">     532 </span>                :            : #endif
<span class="lineNum">     533 </span>                :<span class="lineCov">          8 :         QString ext = QFileInfo(filename_temp).suffix();</span>
<span class="lineNum">     534 </span>                :<span class="lineCov">         12 :         if (!ext.compare(&quot;png&quot;, Qt::CaseInsensitive) ||</span>
<span class="lineNum">     535 </span>                :<span class="lineCov">          8 :             !ext.compare(&quot;jpg&quot;, Qt::CaseInsensitive) ||</span>
<span class="lineNum">     536 </span>                :<span class="lineCov">          4 :             !ext.compare(&quot;jpeg&quot;, Qt::CaseInsensitive)) {</span>
<span class="lineNum">     537 </span>                :<span class="lineCov">          4 :             this-&gt;oldFilename = this-&gt;filename;</span>
<span class="lineNum">     538 </span>                :<span class="lineCov">          4 :             this-&gt;filename = filename_temp;</span>
<span class="lineNum">     539 </span>                :<span class="lineCov">          4 :             this-&gt;oldFile = this-&gt;file;</span>
<span class="lineNum">     540 </span>                :<span class="lineCov">          8 :             this-&gt;file = QFileInfo(filename);</span>
<span class="lineNum">     541 </span>                :<span class="lineCov">          4 :             this-&gt;oldPath = this-&gt;path;</span>
<span class="lineNum">     542 </span>                :<span class="lineCov">          8 :             this-&gt;path = file.dir();</span>
<span class="lineNum">     543 </span>                :            :             this-&gt;oldImagesList = this-&gt;imagesList;
<span class="lineNum">     544 </span>                :<span class="lineCov">         16 :             this-&gt;imagesList = path.entryList(QStringList() &lt;&lt; &quot;*.jpg&quot; &lt;&lt; &quot;*.JPG&quot; &lt;&lt; &quot;*.png&quot; &lt;&lt; &quot;*.PNG&quot; &lt;&lt; &quot;*.JPEG&quot;, QDir::Files);</span>
<span class="lineNum">     545 </span>                :<span class="lineCov">          4 :             if (imagesList.empty()) {</span>
<span class="lineNum">     546 </span>                :<span class="lineNoCov">          0 :                 assertError(&quot;That doesn't seem to be a valid image file.&quot;);</span>
<span class="lineNum">     547 </span>                :<span class="lineNoCov">          0 :                 revert();</span>
<span class="lineNum">     548 </span>                :            :             } else {
<span class="lineNum">     549 </span>                :            :                 int counter = 0;
<span class="lineNum">     550 </span>                :<span class="lineCov">          8 :                 foreach(QString tempFilename, imagesList) {</span>
<span class="lineNum">     551 </span>                :<span class="lineCov">          4 :                     QFileInfo tempInfo = QFileInfo(tempFilename);</span>
<span class="lineNum">     552 </span>                :<span class="lineCov">          4 :                     if (file.completeBaseName() == tempInfo.completeBaseName()) {</span>
<span class="lineNum">     553 </span>                :            :                         break;
<span class="lineNum">     554 </span>                :            :                     }
<span class="lineNum">     555 </span>                :<span class="lineNoCov">          0 :                     counter++;</span>
<span class="lineNum">     556 </span>                :<span class="lineCov">          4 :                 }</span>
<span class="lineNum">     557 </span>                :<span class="lineCov">          4 :                 fileId = counter;</span>
<span class="lineNum">     558 </span>                :            : 
<span class="lineNum">     559 </span>                :<span class="lineCov">          4 :                 openFile_and_labels();</span>
<span class="lineNum">     560 </span>                :<span class="lineCov">          8 :                 QTextStream(stdout) &lt;&lt; currentProject-&gt;numLabels() &lt;&lt; &quot;\n&quot;;</span>
<span class="lineNum">     561 </span>                :            :             }
<span class="lineNum">     562 </span>                :            :         } else {
<span class="lineNum">     563 </span>                :<span class="lineNoCov">          0 :             assertError(&quot;That doesn't seem to be a valid image file.&quot;);</span>
<span class="lineNum">     564 </span>                :<span class="lineCov">          4 :         }</span>
<span class="lineNum">     565 </span>                :            :     } else {
<span class="lineNum">     566 </span>                :<span class="lineNoCov">          0 :         QString databaseImagesURL = this-&gt;databaseURL+&quot;/projects/1/images&quot;;</span>
<span class="lineNum">     567 </span>                :<span class="lineNoCov">          0 :         QUrl dabaseLink = QUrl(databaseImagesURL);</span>
<span class="lineNum">     568 </span>                :            : 
<span class="lineNum">     569 </span>                :<span class="lineNoCov">          0 :         qInfo() &lt;&lt; databaseImagesURL;</span>
<span class="lineNum">     570 </span>                :            : 
<span class="lineNum">     571 </span>                :<span class="lineNoCov">          0 :         QNetworkRequest req = QNetworkRequest(dabaseLink);</span>
<span class="lineNum">     572 </span>                :<span class="lineNoCov">          0 :         req.setRawHeader(&quot;Authorization&quot;, &quot;Bearer &quot; + this-&gt;accessToken.toUtf8());</span>
<span class="lineNum">     573 </span>                :            :         // debugRequest(req);
<span class="lineNum">     574 </span>                :<span class="lineNoCov">          0 :         rep = manager-&gt;get(req);</span>
<span class="lineNum">     575 </span>                :            : 
<span class="lineNum">     576 </span>                :            :         connect(rep, &amp;QNetworkReply::finished,
<span class="lineNum">     577 </span>                :<span class="lineNoCov">          0 :                 this, &amp;InstaDam::imagesReplyFinished);</span>
<span class="lineNum">     578 </span>                :            : 
<span class="lineNum">     579 </span>                :<span class="lineNoCov">          0 :         qInfo() &lt;&lt; &quot;waiting for the reply...&quot;;</span>
<span class="lineNum">     580 </span>                :            :     }
<span class="lineNum">     581 </span>                :            : #endif
<span class="lineNum">     582 </span>                :<span class="lineCov">          4 : }</span>
<span class="lineNum">     583 </span>                :            : 
<span class="lineNum">     584 </span>                :            : #ifdef WASM_BUILD
<span class="lineNum">     585 </span>                :            : void InstaDam::loadRawImage() {
<span class="lineNum">     586 </span>                :            :     openFile_and_labels();
<span class="lineNum">     587 </span>                :            : }
<span class="lineNum">     588 </span>                :            : #endif
<span class="lineNum">     589 </span>                :            : // Generates the file name for the next file in the folder
<span class="lineNum">     590 </span>                :            : 
<span class="lineNum">     591 </span>                :            : /*!
<span class="lineNum">     592 </span>                :            :  Saves the current annotation and opens the next image in the same folder that the current image
<span class="lineNum">     593 </span>                :            :  is in.
<span class="lineNum">     594 </span>                :            :   */
<span class="lineNum">     595 </span>                :<span class="lineNoCov">          0 : void InstaDam::on_saveAndNext_clicked() {</span>
<span class="lineNum">     596 </span>                :<span class="lineNoCov">          0 :     if (imagesList.empty()) {</span>
<span class="lineNum">     597 </span>                :<span class="lineNoCov">          0 :             assertError(&quot;No file loaded! Please go to File-&gt;Open File and select an image to open&quot;);</span>
<span class="lineNum">     598 </span>                :            :     } else {
<span class="lineNum">     599 </span>                :            : 
<span class="lineNum">     600 </span>                :<span class="lineNoCov">          0 :         qInfo(&quot;Going to save idantn&quot;);</span>
<span class="lineNum">     601 </span>                :<span class="lineNoCov">          0 :         on_actionSave_Annotation_triggered();</span>
<span class="lineNum">     602 </span>                :<span class="lineNoCov">          0 :         qInfo(&quot;saved idantn&quot;);</span>
<span class="lineNum">     603 </span>                :<span class="lineNoCov">          0 :         int newId = (fileId+1)%imagesList.size();</span>
<span class="lineNum">     604 </span>                :<span class="lineNoCov">          0 :         QTextStream(stdout) &lt;&lt; &quot;NewId = &quot; &lt;&lt; newId &lt;&lt; &quot;\n&quot;;</span>
<span class="lineNum">     605 </span>                :<span class="lineNoCov">          0 :         scene-&gt;clearItems();</span>
<span class="lineNum">     606 </span>                :<span class="lineNoCov">          0 :         maskScene-&gt;clearItems();</span>
<span class="lineNum">     607 </span>                :<span class="lineNoCov">          0 :         for (int i = 0; i &lt; currentProject-&gt;getLabels().size(); i++) {</span>
<span class="lineNum">     608 </span>                :<span class="lineNoCov">          0 :             currentProject-&gt;getLabel(i)-&gt;clear();</span>
<span class="lineNum">     609 </span>                :            :         }
<span class="lineNum">     610 </span>                :            : 
<span class="lineNum">     611 </span>                :<span class="lineNoCov">          0 :         fileId = newId;</span>
<span class="lineNum">     612 </span>                :<span class="lineNoCov">          0 :         this-&gt;filename = path.absolutePath()+&quot;/&quot;+imagesList[fileId];</span>
<span class="lineNum">     613 </span>                :<span class="lineNoCov">          0 :         this-&gt;file = QFileInfo(this-&gt;filename);</span>
<span class="lineNum">     614 </span>                :<span class="lineNoCov">          0 :         openFile_and_labels();</span>
<span class="lineNum">     615 </span>                :            : 
<span class="lineNum">     616 </span>                :<span class="lineNoCov">          0 :         qInfo(&quot;File opened&quot;);</span>
<span class="lineNum">     617 </span>                :            :     }
<span class="lineNum">     618 </span>                :<span class="lineNoCov">          0 : }</span>
<span class="lineNum">     619 </span>                :            : 
<span class="lineNum">     620 </span>                :            : /*!
<span class="lineNum">     621 </span>                :            :  Saves the current annotation and opens the previous image in the same folder that the current image
<span class="lineNum">     622 </span>                :            :  is in.
<span class="lineNum">     623 </span>                :            :   */
<span class="lineNum">     624 </span>                :<span class="lineNoCov">          0 : void InstaDam::on_saveAndBack_clicked() {</span>
<span class="lineNum">     625 </span>                :<span class="lineNoCov">          0 :     if (imagesList.empty()) {</span>
<span class="lineNum">     626 </span>                :<span class="lineNoCov">          0 :             assertError(&quot;No file loaded! Please go to File-&gt;Open File and select an image to open&quot;);</span>
<span class="lineNum">     627 </span>                :            :     } else {
<span class="lineNum">     628 </span>                :<span class="lineNoCov">          0 :         qInfo(&quot;Going to save idantn&quot;);</span>
<span class="lineNum">     629 </span>                :<span class="lineNoCov">          0 :         on_actionSave_Annotation_triggered();</span>
<span class="lineNum">     630 </span>                :<span class="lineNoCov">          0 :         qInfo(&quot;saved idantn&quot;);</span>
<span class="lineNum">     631 </span>                :<span class="lineNoCov">          0 :         int newId = ((fileId-1)%imagesList.size()+imagesList.size())%imagesList.size();</span>
<span class="lineNum">     632 </span>                :<span class="lineNoCov">          0 :         scene-&gt;clearItems();</span>
<span class="lineNum">     633 </span>                :<span class="lineNoCov">          0 :         maskScene-&gt;clearItems();</span>
<span class="lineNum">     634 </span>                :<span class="lineNoCov">          0 :         for (int i = 0; i &lt; currentProject-&gt;getLabels().size(); i++) {</span>
<span class="lineNum">     635 </span>                :<span class="lineNoCov">          0 :             currentProject-&gt;getLabel(i)-&gt;clear();</span>
<span class="lineNum">     636 </span>                :            :         }
<span class="lineNum">     637 </span>                :            : 
<span class="lineNum">     638 </span>                :<span class="lineNoCov">          0 :         fileId = newId;</span>
<span class="lineNum">     639 </span>                :<span class="lineNoCov">          0 :         this-&gt;filename = path.absolutePath()+&quot;/&quot;+imagesList[fileId];</span>
<span class="lineNum">     640 </span>                :<span class="lineNoCov">          0 :         this-&gt;file = QFileInfo(this-&gt;filename);</span>
<span class="lineNum">     641 </span>                :<span class="lineNoCov">          0 :         openFile_and_labels();</span>
<span class="lineNum">     642 </span>                :            : 
<span class="lineNum">     643 </span>                :<span class="lineNoCov">          0 :         qInfo(&quot;File opened&quot;);</span>
<span class="lineNum">     644 </span>                :            :     }
<span class="lineNum">     645 </span>                :<span class="lineNoCov">          0 : }</span>
<span class="lineNum">     646 </span>                :            : 
<span class="lineNum">     647 </span>                :            : /*!
<span class="lineNum">     648 </span>                :            :  Saves the current annotations as rasterized PNGs or as a buffer depending on the value of
<a name="649"><span class="lineNum">     649 </span>                :            :  \a asBuffers</a>
<span class="lineNum">     650 </span>                :            :   */
<span class="lineNum">     651 </span>                :<span class="lineNoCov">          0 : void InstaDam::exportImages(bool asBuffers) {</span>
<span class="lineNum">     652 </span>                :            :     QString baseName = this-&gt;filename;
<span class="lineNum">     653 </span>                :<span class="lineNoCov">          0 :     for (int i = 0; i &lt; currentProject-&gt;numLabels(); i++) {</span>
<span class="lineNum">     654 </span>                :<span class="lineNoCov">          0 :         QSharedPointer&lt;Label&gt; label = currentProject-&gt;getLabel(i);</span>
<span class="lineNum">     655 </span>                :<span class="lineNoCov">          0 :         QString filename = baseName + &quot;_&quot; + label-&gt;getText() + &quot;.png&quot;;</span>
<span class="lineNum">     656 </span>                :<span class="lineNoCov">          0 :         if (asBuffers) {</span>
<span class="lineNum">     657 </span>                :<span class="lineNoCov">          0 :             QByteArray *bytes = new QByteArray();</span>
<span class="lineNum">     658 </span>                :<span class="lineNoCov">          0 :             QBuffer *buffer = new QBuffer(bytes);</span>
<span class="lineNum">     659 </span>                :<span class="lineNoCov">          0 :             label-&gt;exportLabel(SelectItem::myBounds).save(buffer, &quot;PNG&quot;);</span>
<span class="lineNum">     660 </span>                :<span class="lineNoCov">          0 :             exportFiles.insert(filename, buffer);</span>
<span class="lineNum">     661 </span>                :            :         } else {
<span class="lineNum">     662 </span>                :<span class="lineNoCov">          0 :             label-&gt;exportLabel(SelectItem::myBounds).save(filename, &quot;PNG&quot;);</span>
<span class="lineNum">     663 </span>                :            :         }
<span class="lineNum">     664 </span>                :<span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     665 </span>                :<span class="lineNoCov">          0 : }</span>
<span class="lineNum">     666 </span>                :            : 
<span class="lineNum">     667 </span>                :            : /*!
<a name="668"><span class="lineNum">     668 </span>                :            :  Displays the std::string \a errorMessage as a QMessageBox.</a>
<span class="lineNum">     669 </span>                :            :   */
<span class="lineNum">     670 </span>                :<span class="lineNoCov">          0 : void InstaDam::assertError(std::string errorMessage) {</span>
<span class="lineNum">     671 </span>                :            : #ifndef TEST
<span class="lineNum">     672 </span>                :            :     QMessageBox *messageBox = new QMessageBox;
<span class="lineNum">     673 </span>                :            :     messageBox-&gt;critical(nullptr, &quot;Error&quot;, QString::fromStdString(errorMessage));
<span class="lineNum">     674 </span>                :            :     messageBox-&gt;setFixedSize(500, 200);
<span class="lineNum">     675 </span>                :            : #else
<span class="lineNum">     676 </span>                :<span class="lineNoCov">          0 :     assertThrown = true;</span>
<span class="lineNum">     677 </span>                :<span class="lineNoCov">          0 :     QTextStream(stdout) &lt;&lt; &quot;ERROR &quot; &lt;&lt; QString(errorMessage.c_str()) &lt;&lt; endl;</span>
<span class="lineNum">     678 </span>                :            : #endif
<span class="lineNum">     679 </span>                :<span class="lineNoCov">          0 : }</span>
<span class="lineNum">     680 </span>                :            : 
<span class="lineNum">     681 </span>                :            : /*!
<span class="lineNum">     682 </span>                :            :  Generates the annotation and export file names to be stored locally based on the location
<a name="683"><span class="lineNum">     683 </span>                :            :  and name of the image files.</a>
<span class="lineNum">     684 </span>                :            :   */
<span class="lineNum">     685 </span>                :<span class="lineCov">          4 : void InstaDam::generateLabelFileName() {</span>
<span class="lineNum">     686 </span>                :<span class="lineCov">          4 :     QString baseName = this-&gt;file.baseName();</span>
<span class="lineNum">     687 </span>                :<span class="lineCov">          8 :     QString aPath = this-&gt;path.absolutePath()+&quot;/annotations/&quot;+baseName+&quot;/&quot;;</span>
<span class="lineNum">     688 </span>                :<span class="lineCov">          8 :     QString exPath = this-&gt;path.absolutePath()+&quot;/exports/&quot;+baseName+&quot;/&quot;;</span>
<span class="lineNum">     689 </span>                :<span class="lineCov">          4 :     if (!QDir(aPath).exists()) {</span>
<span class="lineNum">     690 </span>                :<span class="lineCov">          3 :         QDir().mkpath(aPath);</span>
<span class="lineNum">     691 </span>                :            :     }
<span class="lineNum">     692 </span>                :<span class="lineCov">          4 :     if (!QDir(exPath).exists()) {</span>
<span class="lineNum">     693 </span>                :<span class="lineCov">          1 :         QDir().mkpath(exPath);</span>
<span class="lineNum">     694 </span>                :            :     }
<span class="lineNum">     695 </span>                :<span class="lineCov">          4 :     this-&gt;oldLabelPaths = this-&gt;labelPaths;</span>
<span class="lineNum">     696 </span>                :            :     labelPaths.clear();
<span class="lineNum">     697 </span>                :<span class="lineCov">          4 :     this-&gt;oldAnnotationPath = this-&gt;annotationPath;</span>
<span class="lineNum">     698 </span>                :<span class="lineCov">          4 :     this-&gt;annotationPath = aPath+baseName+&quot;.idantn&quot;;</span>
<span class="lineNum">     699 </span>                :<span class="lineCov">         12 :     this-&gt;path = file.dir();</span>
<span class="lineNum">     700 </span>                :<span class="lineCov">          4 : }</span>
<span class="lineNum">     701 </span>                :            : 
<span class="lineNum">     702 </span>                :            : /*!
<span class="lineNum">     703 </span>                :            :  Uses  defined QStringList of images in the path as well as the id of the current file
<a name="704"><span class="lineNum">     704 </span>                :            :  and opens the file. If annotations exist, the annotations are opened.</a>
<span class="lineNum">     705 </span>                :            :  */
<span class="lineNum">     706 </span>                :<span class="lineCov">          4 : void InstaDam::openFile_and_labels() {</span>
<span class="lineNum">     707 </span>                :            : #ifdef WASM_BUILD
<span class="lineNum">     708 </span>                :            :     SelectItem::myBounds = ui-&gt;IdmPhotoViewer-&gt;setPhotoFromByteArray(imageFileContent, labelNameTemp);
<span class="lineNum">     709 </span>                :            : #else
<span class="lineNum">     710 </span>                :            :     // Open labels
<span class="lineNum">     711 </span>                :<span class="lineCov">          4 :     generateLabelFileName();</span>
<span class="lineNum">     712 </span>                :<span class="lineCov">          4 :     if (QFileInfo(this-&gt;annotationPath).isFile()) {</span>
<span class="lineNum">     713 </span>                :<span class="lineCov">          2 :         QTextStream(stdout) &lt;&lt; &quot;Loading labels\n&quot; &lt;&lt; this-&gt;annotationPath &lt;&lt; endl;</span>
<span class="lineNum">     714 </span>                :<span class="lineCov">          3 :         QTextStream(stdout) &lt;&lt; &quot;\n&quot; &lt;&lt; this-&gt;file.baseName() &lt;&lt; endl;</span>
<span class="lineNum">     715 </span>                :<span class="lineCov">          1 :         if (!loadLabelFile(this-&gt;annotationPath, ANNOTATION)) {</span>
<span class="lineNum">     716 </span>                :<span class="lineNoCov">          0 :             revert();</span>
<span class="lineNum">     717 </span>                :<span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">     718 </span>                :            :         }
<span class="lineNum">     719 </span>                :<span class="lineCov">          2 :         QTextStream(stdout) &lt;&lt; &quot;Loaded labels&quot; &lt;&lt; endl;;</span>
<span class="lineNum">     720 </span>                :<span class="lineCov">          3 :     } else if (currentProject != nullptr &amp;&amp; currentProject-&gt;numLabels() == 0) {</span>
<span class="lineNum">     721 </span>                :<span class="lineNoCov">          0 :         assertError(&quot;Please create or open a project first. Projects define the label classes and the color to annotate them. You can open or create a project from the Project menu.&quot;);</span>
<span class="lineNum">     722 </span>                :<span class="lineNoCov">          0 :         revert();</span>
<span class="lineNum">     723 </span>                :<span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">     724 </span>                :            :     }
<span class="lineNum">     725 </span>                :<span class="lineCov">          8 :     QTextStream(stdout) &lt;&lt; &quot;Loading photoX&quot; &lt;&lt; endl;;</span>
<span class="lineNum">     726 </span>                :            : 
<span class="lineNum">     727 </span>                :<span class="lineCov">          4 :     SelectItem::myBounds = ui-&gt;IdmPhotoViewer-&gt;setPhotoFromFile(filename);</span>
<span class="lineNum">     728 </span>                :<span class="lineCov">          4 :     qInfo(&quot;my bounds set&quot;);</span>
<span class="lineNum">     729 </span>                :            : #endif
<span class="lineNum">     730 </span>                :<span class="lineCov">          4 :     ui-&gt;IdmMaskViewer-&gt;LinkToPhotoViewer(ui-&gt;IdmPhotoViewer);</span>
<span class="lineNum">     731 </span>                :            : 
<span class="lineNum">     732 </span>                :<span class="lineCov">          4 :     qInfo(&quot;photo viewer linked!&quot;);</span>
<span class="lineNum">     733 </span>                :<span class="lineCov">          4 :     populateSceneFromProjectLabels();</span>
<span class="lineNum">     734 </span>                :<span class="lineCov">          4 :     scene-&gt;inactiveAll();</span>
<span class="lineNum">     735 </span>                :<span class="lineCov">          4 :     mainUndoStack-&gt;clear();</span>
<span class="lineNum">     736 </span>                :<span class="lineCov">          4 :     tempUndoStack-&gt;clear();</span>
<span class="lineNum">     737 </span>                :<span class="lineCov">          4 :     undoGroup-&gt;setActiveStack(mainUndoStack);</span>
<span class="lineNum">     738 </span>                :<span class="lineCov">          4 :     scene-&gt;update();</span>
<span class="lineNum">     739 </span>                :<span class="lineCov">          4 :     maskScene-&gt;update();</span>
<span class="lineNum">     740 </span>                :            : }
<span class="lineNum">     741 </span>                :            : 
<span class="lineNum">     742 </span>                :            : /*!
<span class="lineNum">     743 </span>                :            :  Populates the PhotoScene with the labels of the current project.
<span class="lineNum">     744 </span>                :            :  */
<span class="lineNum">     745 </span>                :<span class="lineCov">          4 : void InstaDam::populateSceneFromProjectLabels()</span>
<span class="lineNum">     746 </span>                :            : {
<span class="lineNum">     747 </span>                :<span class="lineCov">         16 :     for (int i = 0; i &lt; currentProject-&gt;numLabels(); i++) {</span>
<span class="lineNum">     748 </span>                :<span class="lineCov">         12 :         QSharedPointer&lt;Label&gt; label = currentProject-&gt;getLabel(i);</span>
<span class="lineNum">     749 </span>                :            : 
<span class="lineNum">     750 </span>                :<span class="lineCov">         12 :         if (!label-&gt;rectangleObjects.isEmpty()) {</span>
<span class="lineNum">     751 </span>                :<span class="lineCov">          1 :             QHashIterator&lt;int, RectangleSelect*&gt; rit(label-&gt;rectangleObjects);</span>
<span class="lineNum">     752 </span>                :<span class="lineCov">          2 :             while (rit.hasNext()) {</span>
<span class="lineNum">     753 </span>                :            :                 rit.next();
<span class="lineNum">     754 </span>                :<span class="lineCov">          1 :                 RectangleSelect *mirror = new RectangleSelect();</span>
<span class="lineNum">     755 </span>                :<span class="lineCov">          2 :                 rit.value()-&gt;setLabel(label);</span>
<span class="lineNum">     756 </span>                :<span class="lineCov">          2 :                 mirror-&gt;setLabel(label);</span>
<span class="lineNum">     757 </span>                :<span class="lineCov">          1 :                 mirror-&gt;updatePen(mirror-&gt;myPen);</span>
<span class="lineNum">     758 </span>                :<span class="lineCov">          1 :                 rit.value()-&gt;setMirror(mirror);</span>
<span class="lineNum">     759 </span>                :<span class="lineCov">          2 :                 mirror-&gt;setMirror(rit.value());</span>
<span class="lineNum">     760 </span>                :<span class="lineCov">          3 :                 mirror-&gt;setRectUnchecked(rit.value()-&gt;getRect());</span>
<span class="lineNum">     761 </span>                :<span class="lineCov">          1 :                 rit.value()-&gt;rotateMirror();</span>
<span class="lineNum">     762 </span>                :<span class="lineCov">          1 :                 scene-&gt;addItem(rit.value());</span>
<span class="lineNum">     763 </span>                :<span class="lineCov">          1 :                 maskScene-&gt;addItem(mirror);</span>
<span class="lineNum">     764 </span>                :<span class="lineCov">          1 :                 rit.value()-&gt;itemWasAdded();</span>
<span class="lineNum">     765 </span>                :            :                 mirror-&gt;itemWasAdded();
<span class="lineNum">     766 </span>                :            :             }
<span class="lineNum">     767 </span>                :            :         }
<span class="lineNum">     768 </span>                :<span class="lineCov">         12 :         if (!label-&gt;ellipseObjects.isEmpty()) {</span>
<span class="lineNum">     769 </span>                :<span class="lineCov">          1 :             QHashIterator&lt;int, EllipseSelect*&gt; eit(label-&gt;ellipseObjects);</span>
<span class="lineNum">     770 </span>                :<span class="lineCov">          3 :             while (eit.hasNext()) {</span>
<span class="lineNum">     771 </span>                :            :                 eit.next();
<span class="lineNum">     772 </span>                :<span class="lineCov">          2 :                 EllipseSelect *mirror = new EllipseSelect();</span>
<span class="lineNum">     773 </span>                :<span class="lineCov">          4 :                 eit.value()-&gt;setLabel(label);</span>
<span class="lineNum">     774 </span>                :<span class="lineCov">          4 :                 mirror-&gt;setLabel(label);</span>
<span class="lineNum">     775 </span>                :<span class="lineCov">          2 :                 mirror-&gt;updatePen(mirror-&gt;myPen);</span>
<span class="lineNum">     776 </span>                :<span class="lineCov">          2 :                 eit.value()-&gt;setMirror(mirror);</span>
<span class="lineNum">     777 </span>                :<span class="lineCov">          4 :                 mirror-&gt;setMirror(eit.value());</span>
<span class="lineNum">     778 </span>                :<span class="lineCov">          6 :                 mirror-&gt;setRectUnchecked(eit.value()-&gt;getRect());</span>
<span class="lineNum">     779 </span>                :<span class="lineCov">          2 :                 eit.value()-&gt;rotateMirror();</span>
<span class="lineNum">     780 </span>                :<span class="lineCov">          2 :                 scene-&gt;addItem(eit.value());</span>
<span class="lineNum">     781 </span>                :<span class="lineCov">          2 :                 maskScene-&gt;addItem(mirror);</span>
<span class="lineNum">     782 </span>                :<span class="lineCov">          2 :                 eit.value()-&gt;itemWasAdded();</span>
<span class="lineNum">     783 </span>                :            :                 mirror-&gt;itemWasAdded();
<span class="lineNum">     784 </span>                :            :             }
<span class="lineNum">     785 </span>                :            :         }
<span class="lineNum">     786 </span>                :<span class="lineCov">         12 :         if (!label-&gt;polygonObjects.isEmpty()) {</span>
<span class="lineNum">     787 </span>                :<span class="lineCov">          1 :             QHashIterator&lt;int, PolygonSelect*&gt; pit(label-&gt;polygonObjects);</span>
<span class="lineNum">     788 </span>                :<span class="lineCov">          2 :             while (pit.hasNext()) {</span>
<span class="lineNum">     789 </span>                :            :                 pit.next();
<span class="lineNum">     790 </span>                :<span class="lineCov">          1 :                 PolygonSelect *mirror = new PolygonSelect();</span>
<span class="lineNum">     791 </span>                :<span class="lineCov">          2 :                 pit.value()-&gt;setLabel(label);</span>
<span class="lineNum">     792 </span>                :<span class="lineCov">          2 :                 mirror-&gt;setLabel(label);</span>
<span class="lineNum">     793 </span>                :<span class="lineCov">          1 :                 mirror-&gt;updatePen(mirror-&gt;myPen);</span>
<span class="lineNum">     794 </span>                :<span class="lineCov">          1 :                 pit.value()-&gt;setMirror(mirror);</span>
<span class="lineNum">     795 </span>                :<span class="lineCov">          2 :                 mirror-&gt;setMirror(pit.value());</span>
<span class="lineNum">     796 </span>                :<span class="lineCov">          1 :                 pit.value()-&gt;setMirrorPolygon(SelectItem::UNSELECTED);</span>
<span class="lineNum">     797 </span>                :<span class="lineCov">          1 :                 scene-&gt;addItem(pit.value());</span>
<span class="lineNum">     798 </span>                :<span class="lineCov">          1 :                 maskScene-&gt;addItem(mirror);</span>
<span class="lineNum">     799 </span>                :<span class="lineCov">          1 :                 pit.value()-&gt;itemWasAdded();</span>
<span class="lineNum">     800 </span>                :            :                 mirror-&gt;itemWasAdded();
<span class="lineNum">     801 </span>                :            :             }
<span class="lineNum">     802 </span>                :            :         }
<span class="lineNum">     803 </span>                :<span class="lineCov">         12 :         if (!label-&gt;freeDrawObjects.isEmpty()) {</span>
<span class="lineNum">     804 </span>                :<span class="lineCov">          2 :             FreeDrawSelect *item = label-&gt;freeDrawObjects.values()[0];</span>
<span class="lineNum">     805 </span>                :<span class="lineCov">          1 :             FreeDrawSelect *mirror = new FreeDrawSelect();</span>
<span class="lineNum">     806 </span>                :<span class="lineCov">          2 :             item-&gt;setLabel(label);</span>
<span class="lineNum">     807 </span>                :<span class="lineCov">          2 :             mirror-&gt;setLabel(label);</span>
<span class="lineNum">     808 </span>                :<span class="lineCov">          1 :             mirror-&gt;updatePen(mirror-&gt;myPen);</span>
<span class="lineNum">     809 </span>                :<span class="lineCov">          1 :             item-&gt;setMirror(mirror);</span>
<span class="lineNum">     810 </span>                :<span class="lineCov">          1 :             mirror-&gt;setMirror(item);</span>
<span class="lineNum">     811 </span>                :<span class="lineCov">          1 :             item-&gt;setMirrorMap();</span>
<span class="lineNum">     812 </span>                :<span class="lineCov">          1 :             scene-&gt;addItem(item);</span>
<span class="lineNum">     813 </span>                :<span class="lineCov">          1 :             maskScene-&gt;addItem(mirror);</span>
<span class="lineNum">     814 </span>                :            :             item-&gt;itemWasAdded();
<span class="lineNum">     815 </span>                :            :             mirror-&gt;itemWasAdded();
<span class="lineNum">     816 </span>                :            :         }
<span class="lineNum">     817 </span>                :<span class="lineCov">         24 :         label-&gt;setMaskState(ui-&gt;showMaskSelections-&gt;checkState());</span>
<span class="lineNum">     818 </span>                :            :     }
<span class="lineNum">     819 </span>                :<span class="lineCov">          4 : }</span>
<span class="lineNum">     820 </span>                :            : 
<span class="lineNum">     821 </span>                :            : /*!
<span class="lineNum">     822 </span>                :            :  InstaDam::loadLabelFile loads the Qstring \a filename of fileTypes
<a name="823"><span class="lineNum">     823 </span>                :            :  \a fileType where \fileType is either a PROJECT or ANNOTATION</a>
<span class="lineNum">     824 </span>                :            :  */
<span class="lineNum">     825 </span>                :<span class="lineCov">          2 : bool InstaDam::loadLabelFile(QString filename, fileTypes fileType) {</span>
<span class="lineNum">     826 </span>                :            : #ifdef WASM_BUILD
<span class="lineNum">     827 </span>                :            :     QByteArray saveData = idproFileContent;
<span class="lineNum">     828 </span>                :            : #else
<span class="lineNum">     829 </span>                :<span class="lineCov">          2 :     QFile loadFile(filename);</span>
<span class="lineNum">     830 </span>                :<span class="lineCov">          2 :     if (!loadFile.open(QIODevice::ReadOnly)) {</span>
<span class="lineNum">     831 </span>                :<span class="lineNoCov">          0 :         qWarning(&quot;Couldn't open save file.&quot;);</span>
<span class="lineNum">     832 </span>                :<span class="lineNoCov">          0 :         return false;</span>
<span class="lineNum">     833 </span>                :            :     }
<span class="lineNum">     834 </span>                :<span class="lineCov">          4 :     QByteArray saveData = loadFile.readAll();</span>
<span class="lineNum">     835 </span>                :            : #endif
<span class="lineNum">     836 </span>                :<span class="lineCov">          2 :     QTextStream(stdout) &lt;&lt;&quot;Loaded file&quot;;</span>
<span class="lineNum">     837 </span>                :            : 
<span class="lineNum">     838 </span>                :<span class="lineCov">          4 :     QJsonDocument loadDoc(QJsonDocument::fromJson(saveData));</span>
<span class="lineNum">     839 </span>                :<span class="lineCov">          4 :     return loadLabelJson(loadDoc.object(), fileType);</span>
<span class="lineNum">     840 </span>                :            : }
<span class="lineNum">     841 </span>                :            : 
<span class="lineNum">     842 </span>                :            : /*!
<span class="lineNum">     843 </span>                :            :  InstaDam::loadLabelFile loads the json object \a json of fileTypes
<a name="844"><span class="lineNum">     844 </span>                :            :  \a fileType where \fileType is either a PROJECT or ANNOTATION</a>
<span class="lineNum">     845 </span>                :            :  */
<span class="lineNum">     846 </span>                :<span class="lineCov">          2 : bool InstaDam::loadLabelJson(QJsonObject json, fileTypes fileType){</span>
<span class="lineNum">     847 </span>                :<span class="lineCov">          2 :     currentProject = newProject-&gt;newPr;</span>
<span class="lineNum">     848 </span>                :<span class="lineCov">          2 :     currentProject-&gt;resetLabels();</span>
<span class="lineNum">     849 </span>                :<span class="lineCov">          2 :     clearLayout(ui-&gt;labelClassLayout);</span>
<span class="lineNum">     850 </span>                :            : 
<span class="lineNum">     851 </span>                :<span class="lineCov">          2 :     if (read(json, fileType)) {</span>
<span class="lineNum">     852 </span>                :<span class="lineCov">          2 :         setLabels();</span>
<span class="lineNum">     853 </span>                :<span class="lineCov">          2 :         scene-&gt;clearItems();</span>
<span class="lineNum">     854 </span>                :<span class="lineCov">          2 :         maskScene-&gt;clearItems();</span>
<span class="lineNum">     855 </span>                :<span class="lineCov">          2 :         return true;</span>
<span class="lineNum">     856 </span>                :            :     } else {
<span class="lineNum">     857 </span>                :            :         return false;
<span class="lineNum">     858 </span>                :            :     }
<span class="lineNum">     859 </span>                :            : }
<span class="lineNum">     860 </span>                :            : 
<span class="lineNum">     861 </span>                :            : /*!
<a name="862"><span class="lineNum">     862 </span>                :            :  * Toggles the pan mode.</a>
<span class="lineNum">     863 </span>                :            :  */
<span class="lineNum">     864 </span>                :<span class="lineNoCov">          0 : void InstaDam::panButton_clicked() {</span>
<span class="lineNum">     865 </span>                :<span class="lineNoCov">          0 :     panning = !panning;  // !ui-&gt;panButton-&gt;isChecked();</span>
<span class="lineNum">     866 </span>                :<span class="lineNoCov">          0 :     ui-&gt;panButton-&gt;setChecked(panning);</span>
<span class="lineNum">     867 </span>                :<span class="lineNoCov">          0 :     ui-&gt;IdmPhotoViewer-&gt;setPanMode(panning);</span>
<span class="lineNum">     868 </span>                :<span class="lineNoCov">          0 :     ui-&gt;IdmMaskViewer-&gt;setPanMode(panning);</span>
<span class="lineNum">     869 </span>                :<span class="lineNoCov">          0 : }</span>
<span class="lineNum">     870 </span>                :            : 
<span class="lineNum">     871 </span>                :            : /*!
<a name="872"><span class="lineNum">     872 </span>                :            :  * Slot called when the Rectangle Select button is clicked.</a>
<span class="lineNum">     873 </span>                :            :  */
<span class="lineNum">     874 </span>                :<span class="lineCov">          4 : void InstaDam::on_rectangleSelectButton_clicked() {</span>
<span class="lineNum">     875 </span>                :<span class="lineCov">          4 :     scene-&gt;inactiveAll();</span>
<span class="lineNum">     876 </span>                :<span class="lineCov">          4 :     maskScene-&gt;inactiveAll();</span>
<span class="lineNum">     877 </span>                :<span class="lineCov">          4 :     cancelCurrentSelection();</span>
<span class="lineNum">     878 </span>                :<span class="lineCov">          4 :     currentItem = nullptr;</span>
<span class="lineNum">     879 </span>                :<span class="lineCov">          4 :     switch (currentSelectType) {</span>
<span class="lineNum">     880 </span>                :            :         case SelectItem::Polygon:
<span class="lineNum">     881 </span>                :<span class="lineNoCov">          0 :             if (ui-&gt;selectControlFrame-&gt;findChild&lt;QWidget*&gt;(&quot;polygonSelectForm&quot;)) {</span>
<span class="lineNum">     882 </span>                :<span class="lineNoCov">          0 :                 controlLayout-&gt;removeWidget(polygonSelectWidget);</span>
<span class="lineNum">     883 </span>                :<span class="lineNoCov">          0 :                 polygonSelectWidget-&gt;hide();</span>
<span class="lineNum">     884 </span>                :            :             }
<span class="lineNum">     885 </span>                :<span class="lineNoCov">          0 :             controlLayout-&gt;addWidget(blankWidget);</span>
<span class="lineNum">     886 </span>                :<span class="lineNoCov">          0 :             ui-&gt;polygonSelectButton-&gt;setChecked(false);</span>
<span class="lineNum">     887 </span>                :<span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">     888 </span>                :            :         case SelectItem::Freeerase:
<span class="lineNum">     889 </span>                :            :         case SelectItem::Freedraw:
<span class="lineNum">     890 </span>                :<span class="lineNoCov">          0 :             if (ui-&gt;selectControlFrame-&gt;findChild&lt;QWidget*&gt;(&quot;freeSelectForm&quot;)) {</span>
<span class="lineNum">     891 </span>                :<span class="lineNoCov">          0 :                 controlLayout-&gt;removeWidget(freeSelectWidget);</span>
<span class="lineNum">     892 </span>                :<span class="lineNoCov">          0 :                 freeSelectWidget-&gt;hide();</span>
<span class="lineNum">     893 </span>                :            :             }
<span class="lineNum">     894 </span>                :<span class="lineNoCov">          0 :             ui-&gt;freeSelectButton-&gt;setChecked(false);</span>
<span class="lineNum">     895 </span>                :<span class="lineNoCov">          0 :             controlLayout-&gt;addWidget(blankWidget);</span>
<span class="lineNum">     896 </span>                :            :             break;
<span class="lineNum">     897 </span>                :            :         case SelectItem::Rectangle:
<span class="lineNum">     898 </span>                :            :             break;
<span class="lineNum">     899 </span>                :            :         case SelectItem::Ellipse:
<span class="lineNum">     900 </span>                :<span class="lineCov">          4 :             ui-&gt;ellipseSelectButton-&gt;setChecked(false);</span>
<span class="lineNum">     901 </span>                :<span class="lineCov">          4 :             break;</span>
<span class="lineNum">     902 </span>                :            :     }
<span class="lineNum">     903 </span>                :<span class="lineCov">          4 :     ui-&gt;rectangleSelectButton-&gt;setChecked(true);</span>
<span class="lineNum">     904 </span>                :<span class="lineCov">          4 :     blankForm-&gt;blankText-&gt;setPlainText(rectBaseString);</span>
<span class="lineNum">     905 </span>                :<span class="lineCov">          4 :     blankWidget-&gt;show();</span>
<span class="lineNum">     906 </span>                :<span class="lineCov">          4 :     currentSelectType = SelectItem::Rectangle;</span>
<span class="lineNum">     907 </span>                :<span class="lineCov">          4 :     scene-&gt;update();</span>
<span class="lineNum">     908 </span>                :<span class="lineCov">          4 :     maskScene-&gt;update();</span>
<span class="lineNum">     909 </span>                :<span class="lineCov">          4 : }</span>
<span class="lineNum">     910 </span>                :            : 
<span class="lineNum">     911 </span>                :            : /*!
<a name="912"><span class="lineNum">     912 </span>                :            :  * Slot called when the Ellispe Select button is clicked.</a>
<span class="lineNum">     913 </span>                :            :  */
<span class="lineNum">     914 </span>                :<span class="lineCov">          4 : void InstaDam::on_ellipseSelectButton_clicked() {</span>
<span class="lineNum">     915 </span>                :<span class="lineCov">          4 :     scene-&gt;inactiveAll();</span>
<span class="lineNum">     916 </span>                :<span class="lineCov">          4 :     maskScene-&gt;inactiveAll();</span>
<span class="lineNum">     917 </span>                :<span class="lineCov">          4 :     cancelCurrentSelection();</span>
<span class="lineNum">     918 </span>                :<span class="lineCov">          4 :     currentItem = nullptr;</span>
<span class="lineNum">     919 </span>                :<span class="lineCov">          4 :     switch (currentSelectType) {</span>
<span class="lineNum">     920 </span>                :            :         case SelectItem::Polygon:
<span class="lineNum">     921 </span>                :<span class="lineNoCov">          0 :             if (ui-&gt;selectControlFrame-&gt;findChild&lt;QWidget*&gt;(&quot;polygonSelectForm&quot;)) {</span>
<span class="lineNum">     922 </span>                :<span class="lineNoCov">          0 :                 controlLayout-&gt;removeWidget(polygonSelectWidget);</span>
<span class="lineNum">     923 </span>                :<span class="lineNoCov">          0 :                 polygonSelectWidget-&gt;hide();</span>
<span class="lineNum">     924 </span>                :            :             }
<span class="lineNum">     925 </span>                :<span class="lineNoCov">          0 :             controlLayout-&gt;addWidget(blankWidget);</span>
<span class="lineNum">     926 </span>                :<span class="lineNoCov">          0 :             ui-&gt;polygonSelectButton-&gt;setChecked(false);</span>
<span class="lineNum">     927 </span>                :<span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">     928 </span>                :            :         case SelectItem::Freeerase:
<span class="lineNum">     929 </span>                :            :         case SelectItem::Freedraw:
<span class="lineNum">     930 </span>                :<span class="lineCov">          2 :             if (ui-&gt;selectControlFrame-&gt;findChild&lt;QWidget*&gt;(&quot;freeSelectForm&quot;)) {</span>
<span class="lineNum">     931 </span>                :<span class="lineCov">          1 :                 controlLayout-&gt;removeWidget(freeSelectWidget);</span>
<span class="lineNum">     932 </span>                :<span class="lineCov">          1 :                 freeSelectWidget-&gt;hide();</span>
<span class="lineNum">     933 </span>                :            :             }
<span class="lineNum">     934 </span>                :<span class="lineCov">          1 :             controlLayout-&gt;addWidget(blankWidget);</span>
<span class="lineNum">     935 </span>                :<span class="lineCov">          1 :             ui-&gt;freeSelectButton-&gt;setChecked(false);</span>
<span class="lineNum">     936 </span>                :<span class="lineCov">          1 :             break;</span>
<span class="lineNum">     937 </span>                :            :         case SelectItem::Rectangle:
<span class="lineNum">     938 </span>                :<span class="lineCov">          3 :             ui-&gt;rectangleSelectButton-&gt;setChecked(false);</span>
<span class="lineNum">     939 </span>                :<span class="lineCov">          3 :             break;</span>
<span class="lineNum">     940 </span>                :            :         case SelectItem::Ellipse:
<span class="lineNum">     941 </span>                :            :             break;
<span class="lineNum">     942 </span>                :            :     }
<span class="lineNum">     943 </span>                :<span class="lineCov">          4 :     ui-&gt;ellipseSelectButton-&gt;setChecked(true);</span>
<span class="lineNum">     944 </span>                :<span class="lineCov">          4 :     blankForm-&gt;blankText-&gt;setPlainText(ellipseBaseString);</span>
<span class="lineNum">     945 </span>                :<span class="lineCov">          4 :     blankWidget-&gt;show();</span>
<span class="lineNum">     946 </span>                :<span class="lineCov">          4 :     currentSelectType = SelectItem::Ellipse;</span>
<span class="lineNum">     947 </span>                :<span class="lineCov">          4 :     scene-&gt;update();</span>
<span class="lineNum">     948 </span>                :<span class="lineCov">          4 :     maskScene-&gt;update();</span>
<span class="lineNum">     949 </span>                :<span class="lineCov">          4 : }</span>
<span class="lineNum">     950 </span>                :            : 
<span class="lineNum">     951 </span>                :            : /*!
<a name="952"><span class="lineNum">     952 </span>                :            :  * Slot called when the Polygon Select button is clicked.</a>
<span class="lineNum">     953 </span>                :            :  */
<span class="lineNum">     954 </span>                :<span class="lineCov">          4 : void InstaDam::on_polygonSelectButton_clicked() {</span>
<span class="lineNum">     955 </span>                :<span class="lineCov">          4 :     scene-&gt;inactiveAll();</span>
<span class="lineNum">     956 </span>                :<span class="lineCov">          4 :     maskScene-&gt;inactiveAll();</span>
<span class="lineNum">     957 </span>                :<span class="lineCov">          4 :     cancelCurrentSelection();</span>
<span class="lineNum">     958 </span>                :<span class="lineCov">          4 :     currentItem = nullptr;</span>
<span class="lineNum">     959 </span>                :<span class="lineCov">          4 :     switch (currentSelectType) {</span>
<span class="lineNum">     960 </span>                :            :         case SelectItem::Ellipse:
<span class="lineNum">     961 </span>                :            :         case SelectItem::Rectangle:
<span class="lineNum">     962 </span>                :<span class="lineCov">          8 :             if (ui-&gt;selectControlFrame-&gt;findChild&lt;QWidget*&gt;(&quot;blankForm&quot;)) {</span>
<span class="lineNum">     963 </span>                :<span class="lineCov">          4 :                 controlLayout-&gt;removeWidget(blankWidget);</span>
<span class="lineNum">     964 </span>                :<span class="lineCov">          4 :                 blankWidget-&gt;hide();</span>
<span class="lineNum">     965 </span>                :            :             }
<span class="lineNum">     966 </span>                :<span class="lineCov">          4 :             controlLayout-&gt;addWidget(polygonSelectWidget);</span>
<span class="lineNum">     967 </span>                :<span class="lineCov">          4 :             ui-&gt;ellipseSelectButton-&gt;setChecked(false);</span>
<span class="lineNum">     968 </span>                :<span class="lineCov">          4 :             ui-&gt;rectangleSelectButton-&gt;setChecked(false);</span>
<span class="lineNum">     969 </span>                :<span class="lineCov">          4 :             break;</span>
<span class="lineNum">     970 </span>                :            :         case SelectItem::Freeerase:
<span class="lineNum">     971 </span>                :            :         case SelectItem::Freedraw:
<span class="lineNum">     972 </span>                :<span class="lineNoCov">          0 :             if (ui-&gt;selectControlFrame-&gt;findChild&lt;QWidget*&gt;(&quot;freeSelectForm&quot;)) {</span>
<span class="lineNum">     973 </span>                :<span class="lineNoCov">          0 :                 controlLayout-&gt;removeWidget(freeSelectWidget);</span>
<span class="lineNum">     974 </span>                :<span class="lineNoCov">          0 :                 freeSelectWidget-&gt;hide();</span>
<span class="lineNum">     975 </span>                :            :             }
<span class="lineNum">     976 </span>                :<span class="lineNoCov">          0 :             controlLayout-&gt;addWidget(polygonSelectWidget);</span>
<span class="lineNum">     977 </span>                :<span class="lineNoCov">          0 :             ui-&gt;freeSelectButton-&gt;setChecked(false);</span>
<span class="lineNum">     978 </span>                :<span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">     979 </span>                :            :         case SelectItem::Polygon:
<span class="lineNum">     980 </span>                :            :             break;
<span class="lineNum">     981 </span>                :            :     }
<span class="lineNum">     982 </span>                :<span class="lineCov">          4 :     ui-&gt;polygonSelectButton-&gt;setChecked(true);</span>
<span class="lineNum">     983 </span>                :<span class="lineCov">          4 :     polygonSelectWidget-&gt;show();</span>
<span class="lineNum">     984 </span>                :<span class="lineCov">          4 :     polygonSelectForm-&gt;polygonMessageBox-&gt;setPlainText(polygonBaseInstruction);</span>
<span class="lineNum">     985 </span>                :<span class="lineCov">          4 :     currentSelectType = SelectItem::Polygon;</span>
<span class="lineNum">     986 </span>                :<span class="lineCov">          4 :     scene-&gt;update();</span>
<span class="lineNum">     987 </span>                :<span class="lineCov">          4 : }</span>
<span class="lineNum">     988 </span>                :            : 
<span class="lineNum">     989 </span>                :            : 
<span class="lineNum">     990 </span>                :            : /*!
<a name="991"><span class="lineNum">     991 </span>                :            :  * Slot called when the Free Select button is clicked.</a>
<span class="lineNum">     992 </span>                :            :  */
<span class="lineNum">     993 </span>                :<span class="lineCov">          4 : void InstaDam::on_freeSelectButton_clicked() {</span>
<span class="lineNum">     994 </span>                :<span class="lineCov">          4 :     scene-&gt;inactiveAll();</span>
<span class="lineNum">     995 </span>                :<span class="lineCov">          4 :     cancelCurrentSelection();</span>
<span class="lineNum">     996 </span>                :<span class="lineCov">          4 :     currentItem = nullptr;</span>
<span class="lineNum">     997 </span>                :<span class="lineCov">          4 :     switch (currentSelectType) {</span>
<span class="lineNum">     998 </span>                :            :         case SelectItem::Ellipse:
<span class="lineNum">     999 </span>                :            :         case SelectItem::Rectangle:
<span class="lineNum">    1000 </span>                :<span class="lineNoCov">          0 :             if (ui-&gt;selectControlFrame-&gt;findChild&lt;QWidget*&gt;(&quot;blankForm&quot;)) {</span>
<span class="lineNum">    1001 </span>                :<span class="lineNoCov">          0 :                 controlLayout-&gt;removeWidget(blankWidget);</span>
<span class="lineNum">    1002 </span>                :<span class="lineNoCov">          0 :                 blankWidget-&gt;hide();</span>
<span class="lineNum">    1003 </span>                :            :             }
<span class="lineNum">    1004 </span>                :<span class="lineNoCov">          0 :             controlLayout-&gt;addWidget(freeSelectWidget);</span>
<span class="lineNum">    1005 </span>                :<span class="lineNoCov">          0 :             ui-&gt;ellipseSelectButton-&gt;setChecked(false);</span>
<span class="lineNum">    1006 </span>                :<span class="lineNoCov">          0 :             ui-&gt;rectangleSelectButton-&gt;setChecked(false);</span>
<span class="lineNum">    1007 </span>                :<span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1008 </span>                :            :         case SelectItem::Polygon:
<span class="lineNum">    1009 </span>                :<span class="lineCov">          8 :             if (ui-&gt;selectControlFrame-&gt;findChild&lt;QWidget*&gt;(&quot;polygonSelectForm&quot;)) {</span>
<span class="lineNum">    1010 </span>                :<span class="lineCov">          4 :                 controlLayout-&gt;removeWidget(polygonSelectWidget);</span>
<span class="lineNum">    1011 </span>                :<span class="lineCov">          4 :                 polygonSelectWidget-&gt;hide();</span>
<span class="lineNum">    1012 </span>                :            :             }
<span class="lineNum">    1013 </span>                :<span class="lineCov">          4 :             controlLayout-&gt;addWidget(freeSelectWidget);</span>
<span class="lineNum">    1014 </span>                :<span class="lineCov">          4 :             ui-&gt;polygonSelectButton-&gt;setChecked(false);</span>
<span class="lineNum">    1015 </span>                :<span class="lineCov">          4 :             break;</span>
<span class="lineNum">    1016 </span>                :            :         case SelectItem::Freeerase:
<span class="lineNum">    1017 </span>                :            :         case SelectItem::Freedraw:
<span class="lineNum">    1018 </span>                :            :             break;
<span class="lineNum">    1019 </span>                :            :     }
<span class="lineNum">    1020 </span>                :<span class="lineCov">          4 :     ui-&gt;freeSelectButton-&gt;setChecked(true);</span>
<span class="lineNum">    1021 </span>                :<span class="lineCov">          4 :     freeSelectWidget-&gt;show();</span>
<span class="lineNum">    1022 </span>                :<span class="lineCov">          4 :     currentSelectType = SelectItem::Freedraw;</span>
<span class="lineNum">    1023 </span>                :<span class="lineCov">          4 :     scene-&gt;update();</span>
<span class="lineNum">    1024 </span>                :<span class="lineCov">          4 :     maskScene-&gt;update();</span>
<span class="lineNum">    1025 </span>                :<span class="lineCov">          4 : }</span>
<span class="lineNum">    1026 </span>                :            : 
<span class="lineNum">    1027 </span>                :            : 
<span class="lineNum">    1028 </span>                :            : /*!
<a name="1029"><span class="lineNum">    1029 </span>                :            :  * Slot called when the Free Select mode is changed to a round brush.</a>
<span class="lineNum">    1030 </span>                :            :  */
<span class="lineNum">    1031 </span>                :<span class="lineCov">          4 : void InstaDam::roundBrushButtonClicked() {</span>
<span class="lineNum">    1032 </span>                :<span class="lineCov">          4 :     brushMode = Qt::RoundCap;</span>
<span class="lineNum">    1033 </span>                :<span class="lineCov">          4 :     freeSelectForm-&gt;squareBrushButton-&gt;setChecked(false);</span>
<span class="lineNum">    1034 </span>                :<span class="lineCov">          4 :     freeSelectForm-&gt;roundBrushButton-&gt;setChecked(true);</span>
<span class="lineNum">    1035 </span>                :<span class="lineCov">          4 :     ui-&gt;IdmPhotoViewer-&gt;setBrushMode(Qt::RoundCap);</span>
<span class="lineNum">    1036 </span>                :<span class="lineCov">          4 :     ui-&gt;IdmMaskViewer-&gt;setBrushMode(Qt::RoundCap);</span>
<span class="lineNum">    1037 </span>                :<span class="lineCov">          4 : }</span>
<span class="lineNum">    1038 </span>                :            : 
<span class="lineNum">    1039 </span>                :            : /*!
<a name="1040"><span class="lineNum">    1040 </span>                :            :  * Slot called when the Free Select mode is changed to a square brush.</a>
<span class="lineNum">    1041 </span>                :            :  */
<span class="lineNum">    1042 </span>                :<span class="lineCov">          4 : void InstaDam::squareBrushButtonClicked() {</span>
<span class="lineNum">    1043 </span>                :<span class="lineCov">          4 :     brushMode = Qt::SquareCap;</span>
<span class="lineNum">    1044 </span>                :<span class="lineCov">          4 :     freeSelectForm-&gt;squareBrushButton-&gt;setChecked(true);</span>
<span class="lineNum">    1045 </span>                :<span class="lineCov">          4 :     freeSelectForm-&gt;roundBrushButton-&gt;setChecked(false);</span>
<span class="lineNum">    1046 </span>                :<span class="lineCov">          4 :     ui-&gt;IdmPhotoViewer-&gt;setBrushMode(Qt::SquareCap);</span>
<span class="lineNum">    1047 </span>                :<span class="lineCov">          4 :     ui-&gt;IdmMaskViewer-&gt;setBrushMode(Qt::SquareCap);</span>
<span class="lineNum">    1048 </span>                :<span class="lineCov">          4 : }</span>
<span class="lineNum">    1049 </span>                :            : 
<span class="lineNum">    1050 </span>                :            : /*!
<span class="lineNum">    1051 </span>                :            :  * Slot called when the filter options button is clicked.
<a name="1052"><span class="lineNum">    1052 </span>                :            :  */</a>
<span class="lineNum">    1053 </span>                :            : 
<span class="lineNum">    1054 </span>                :<span class="lineNoCov">          0 : void InstaDam::on_filterOptions_clicked()</span>
<span class="lineNum">    1055 </span>                :            : {
<span class="lineNum">    1056 </span>                :<span class="lineNoCov">          0 :     if (currentProject== nullptr) {</span>
<span class="lineNum">    1057 </span>                :<span class="lineNoCov">          0 :         assertError(&quot;Please create or open a project first. Projects define the label classes and the color to annotate them. You can open or create a project from the Project menu.&quot;);</span>
<span class="lineNum">    1058 </span>                :            :     } else {
<span class="lineNum">    1059 </span>                :            :         filterDialog* dialogs = new filterDialog(ui-&gt;IdmPhotoViewer-&gt;selectedMask,
<span class="lineNum">    1060 </span>                :            :                                                  filterControl, ui-&gt;IdmPhotoViewer,
<span class="lineNum">    1061 </span>                :<span class="lineNoCov">          0 :                                                  currentProject);</span>
<span class="lineNum">    1062 </span>                :<span class="lineNoCov">          0 :         dialogs-&gt;show();</span>
<span class="lineNum">    1063 </span>                :            :     }
<span class="lineNum">    1064 </span>                :<span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1065 </span>                :            : 
<span class="lineNum">    1066 </span>                :            : /*!
<a name="1067"><span class="lineNum">    1067 </span>                :            :  * Function to insert point between two points in the polygon.</a>
<span class="lineNum">    1068 </span>                :            :  */
<span class="lineNum">    1069 </span>                :<span class="lineCov">          1 : void InstaDam::setInsert() {</span>
<span class="lineNum">    1070 </span>                :<span class="lineCov">          1 :     currentItem-&gt;resetState();</span>
<span class="lineNum">    1071 </span>                :<span class="lineCov">          1 :     insertVertex = true;</span>
<span class="lineNum">    1072 </span>                :<span class="lineCov">          1 :     vertex1 = -1;</span>
<span class="lineNum">    1073 </span>                :<span class="lineCov">          1 :     vertex2 = -1;</span>
<span class="lineNum">    1074 </span>                :<span class="lineCov">          1 :     polygonSelectForm-&gt;polygonMessageBox-&gt;setPlainText(&quot;Click the vertices between which you want to insert a point.&quot;);</span>
<span class="lineNum">    1075 </span>                :<span class="lineCov">          1 : }</span>
<span class="lineNum">    1076 </span>                :            : 
<span class="lineNum">    1077 </span>                :            : /*!
<a name="1078"><span class="lineNum">    1078 </span>                :            :  * Slot called when the export annotations option is chosen.</a>
<span class="lineNum">    1079 </span>                :            :  */
<span class="lineNum">    1080 </span>                :<span class="lineNoCov">          0 : void InstaDam::on_actionExport_triggered() {</span>
<span class="lineNum">    1081 </span>                :<span class="lineNoCov">          0 :     exportImages();</span>
<span class="lineNum">    1082 </span>                :<span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1083 </span>                :            : 
<span class="lineNum">    1084 </span>                :            : /*!
<a name="1085"><span class="lineNum">    1085 </span>                :            :  * Slot called when the export zip option is chosen.</a>
<span class="lineNum">    1086 </span>                :            :  */
<span class="lineNum">    1087 </span>                :<span class="lineNoCov">          0 : void InstaDam::on_actionExport_zip_triggered() {</span>
<span class="lineNum">    1088 </span>                :<span class="lineNoCov">          0 :     exportImages(true);</span>
<span class="lineNum">    1089 </span>                :            : #ifdef WASM_BUILD
<span class="lineNum">    1090 </span>                :            :     QByteArray *outbytes;
<span class="lineNum">    1091 </span>                :            : 
<span class="lineNum">    1092 </span>                :            :     QBuffer *outbuffer = new QBuffer(outbytes);
<span class="lineNum">    1093 </span>                :            :     QuaZip zip(outbuffer);
<span class="lineNum">    1094 </span>                :            : #else
<span class="lineNum">    1095 </span>                :<span class="lineNoCov">          0 :     QuaZip zip(this-&gt;filename + &quot;_idpro.zip&quot;);</span>
<span class="lineNum">    1096 </span>                :            : #endif
<span class="lineNum">    1097 </span>                :<span class="lineNoCov">          0 :     if (!zip.open(QuaZip::mdCreate)) {</span>
<span class="lineNum">    1098 </span>                :<span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    1099 </span>                :            :     }
<span class="lineNum">    1100 </span>                :            : 
<span class="lineNum">    1101 </span>                :<span class="lineNoCov">          0 :     QuaZipFile outFile(&amp;zip);</span>
<span class="lineNum">    1102 </span>                :<span class="lineNoCov">          0 :     QHashIterator&lt;QString, QBuffer*&gt; it(exportFiles);</span>
<span class="lineNum">    1103 </span>                :<span class="lineNoCov">          0 :     while (it.hasNext()) {</span>
<span class="lineNum">    1104 </span>                :            :         it.next();
<span class="lineNum">    1105 </span>                :            :         QString filename = it.key();
<span class="lineNum">    1106 </span>                :<span class="lineNoCov">          0 :         QBuffer *buffer = it.value();</span>
<span class="lineNum">    1107 </span>                :            : 
<span class="lineNum">    1108 </span>                :<span class="lineNoCov">          0 :         if (!(*buffer).open(QIODevice::ReadOnly)) {</span>
<span class="lineNum">    1109 </span>                :<span class="lineNoCov">          0 :             qInfo(&quot;Could not access buffer file.&quot;);</span>
<span class="lineNum">    1110 </span>                :<span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    1111 </span>                :            :         }
<span class="lineNum">    1112 </span>                :            : 
<span class="lineNum">    1113 </span>                :<span class="lineNoCov">          0 :         if (!outFile.open(QIODevice::WriteOnly, QuaZipNewInfo(filename, filename))) {</span>
<span class="lineNum">    1114 </span>                :<span class="lineNoCov">          0 :             qInfo(&quot;Error opening zip file.&quot;);</span>
<span class="lineNum">    1115 </span>                :<span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    1116 </span>                :            :         }
<span class="lineNum">    1117 </span>                :<span class="lineNoCov">          0 :         for (qint64 pos = 0, len = (*buffer).size(); pos &lt; len; ) {</span>
<span class="lineNum">    1118 </span>                :            :             char buf[4096];
<span class="lineNum">    1119 </span>                :<span class="lineNoCov">          0 :             qint64 readSize = qMin(static_cast&lt;qint64&gt;(4096), len - pos);</span>
<span class="lineNum">    1120 </span>                :            :             qint64 l;
<span class="lineNum">    1121 </span>                :<span class="lineNoCov">          0 :             if ((l = (*buffer).read(buf, readSize)) != readSize) {</span>
<span class="lineNum">    1122 </span>                :<span class="lineNoCov">          0 :                 qInfo(&quot;Read failure&quot;);</span>
<span class="lineNum">    1123 </span>                :            :             }
<span class="lineNum">    1124 </span>                :            :             qDebug(&quot;Reading %ld bytes from %s at %ld returned %ld&quot;,
<span class="lineNum">    1125 </span>                :            :                    static_cast&lt;long&gt;(readSize),
<span class="lineNum">    1126 </span>                :            :                    filename.toUtf8().constData(),
<span class="lineNum">    1127 </span>                :            :                    static_cast&lt;long&gt;(pos),
<span class="lineNum">    1128 </span>                :<span class="lineNoCov">          0 :                    static_cast&lt;long&gt;(l));</span>
<span class="lineNum">    1129 </span>                :<span class="lineNoCov">          0 :             outFile.write(buf, readSize);</span>
<span class="lineNum">    1130 </span>                :<span class="lineNoCov">          0 :             pos += readSize;</span>
<span class="lineNum">    1131 </span>                :            :         }
<span class="lineNum">    1132 </span>                :<span class="lineNoCov">          0 :         if (outFile.getZipError() != UNZ_OK) {</span>
<span class="lineNum">    1133 </span>                :<span class="lineNoCov">          0 :             qInfo(&quot;Zip file error&quot;);</span>
<span class="lineNum">    1134 </span>                :<span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    1135 </span>                :            :         }
<span class="lineNum">    1136 </span>                :<span class="lineNoCov">          0 :         outFile.close();</span>
<span class="lineNum">    1137 </span>                :            : 
<span class="lineNum">    1138 </span>                :<span class="lineNoCov">          0 :         if (outFile.getZipError() != UNZ_OK) {</span>
<span class="lineNum">    1139 </span>                :<span class="lineNoCov">          0 :             qInfo(&quot;Error closeing zip file.&quot;);</span>
<span class="lineNum">    1140 </span>                :<span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    1141 </span>                :            :         }
<span class="lineNum">    1142 </span>                :            : 
<span class="lineNum">    1143 </span>                :<span class="lineNoCov">          0 :         (*buffer).close();</span>
<span class="lineNum">    1144 </span>                :<span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    1145 </span>                :            : 
<span class="lineNum">    1146 </span>                :<span class="lineNoCov">          0 :     zip.close();</span>
<span class="lineNum">    1147 </span>                :            : 
<span class="lineNum">    1148 </span>                :<span class="lineNoCov">          0 :     if (zip.getZipError() != 0) {</span>
<span class="lineNum">    1149 </span>                :<span class="lineNoCov">          0 :         qInfo(&quot;Error.&quot;);</span>
<span class="lineNum">    1150 </span>                :<span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    1151 </span>                :<span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    1152 </span>                :            : #ifdef WASM_BUILD
<span class="lineNum">    1153 </span>                :            :     QHtml5File::save(outbuffer-&gt;data(), &quot;myproject_idpro.zip&quot;);
<span class="lineNum">    1154 </span>                :            : #endif
<span class="lineNum">    1155 </span>                :            : }
<span class="lineNum">    1156 </span>                :            : 
<span class="lineNum">    1157 </span>                :            : /*!
<span class="lineNum">    1158 </span>                :            :   Processes a point being clicked in the scene \a type, any SelectItem at \a pos
<a name="1159"><span class="lineNum">    1159 </span>                :            :   is given by \a item, andthe button clicked is given as \a button.</a>
<span class="lineNum">    1160 </span>                :            :  */
<span class="lineNum">    1161 </span>                :<span class="lineCov">         39 : void InstaDam::processPointClicked(PhotoScene::viewerTypes type,</span>
<span class="lineNum">    1162 </span>                :            :                                    SelectItem *item, QPointF pos,
<span class="lineNum">    1163 </span>                :            :                                    const Qt::MouseButton button) {
<span class="lineNum">    1164 </span>                :<span class="lineCov">         39 :     currentButton = button;</span>
<span class="lineNum">    1165 </span>                :<span class="lineCov">         39 :     if (!item) {</span>
<span class="lineNum">    1166 </span>                :<span class="lineCov">         32 :         if (!canDrawOnPhoto &amp;&amp; (!currentItem || currentItem-&gt;type() !=</span>
<span class="lineNum">    1167 </span>                :            :                                 SelectItem::Polygon)) {
<span class="lineNum">    1168 </span>                :<span class="lineNoCov">          0 :             scene-&gt;inactiveAll();</span>
<span class="lineNum">    1169 </span>                :<span class="lineNoCov">          0 :             maskScene-&gt;inactiveAll();</span>
<span class="lineNum">    1170 </span>                :<span class="lineNoCov">          0 :             scene-&gt;update();</span>
<span class="lineNum">    1171 </span>                :<span class="lineNoCov">          0 :             maskScene-&gt;update();</span>
<span class="lineNum">    1172 </span>                :<span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    1173 </span>                :            :         }
<span class="lineNum">    1174 </span>                :<span class="lineCov">         30 :         if (type == PhotoScene::MASK_VIEWER_TYPE &amp;&amp; currentSelectType !=</span>
<span class="lineNum">    1175 </span>                :            :             SelectItem::Freedraw) {
<span class="lineNum">    1176 </span>                :<span class="lineNoCov">          0 :             canDrawOnPhoto = false;</span>
<span class="lineNum">    1177 </span>                :<span class="lineNoCov">          0 :             undoGroup-&gt;setActiveStack(tempUndoStack);</span>
<span class="lineNum">    1178 </span>                :<span class="lineNoCov">          0 :             ui-&gt;addSelectionButton-&gt;setEnabled(true);</span>
<span class="lineNum">    1179 </span>                :<span class="lineNoCov">          0 :             ui-&gt;cancelSelectionButton-&gt;setEnabled(true);</span>
<span class="lineNum">    1180 </span>                :            :         }
<span class="lineNum">    1181 </span>                :            : 
<span class="lineNum">    1182 </span>                :<span class="lineCov">         30 :         if (!currentLabel || button == Qt::RightButton) {</span>
<span class="lineNum">    1183 </span>                :            :             return;
<span class="lineNum">    1184 </span>                :            :         }
<span class="lineNum">    1185 </span>                :            : 
<span class="lineNum">    1186 </span>                :<span class="lineCov">         30 :         if (currentItem &amp;&amp; currentItem-&gt;type() == SelectItem::Polygon) {</span>
<span class="lineNum">    1187 </span>                :<span class="lineCov">         10 :             if (insertVertex &amp;&amp; vertex1 &gt;= 0 &amp;&amp; vertex2 &gt;= 0) {</span>
<span class="lineNum">    1188 </span>                :<span class="lineCov">          1 :                 if (abs(vertex2 - vertex1) == 1) {</span>
<span class="lineNum">    1189 </span>                :<span class="lineCov">          2 :                     currentItem-&gt;insertVertex(std::min(vertex1, vertex2), pos);</span>
<span class="lineNum">    1190 </span>                :            :                 } else {
<span class="lineNum">    1191 </span>                :<span class="lineNoCov">          0 :                     currentItem-&gt;insertVertex(std::max(vertex1, vertex2), pos);</span>
<span class="lineNum">    1192 </span>                :            :                 }
<span class="lineNum">    1193 </span>                :<span class="lineCov">          1 :                 vertex1 = -1;</span>
<span class="lineNum">    1194 </span>                :<span class="lineCov">          1 :                 vertex2 = -1;</span>
<span class="lineNum">    1195 </span>                :<span class="lineCov">          1 :                 insertVertex = false;</span>
<span class="lineNum">    1196 </span>                :<span class="lineCov">          1 :                 polygonSelectForm-&gt;polygonMessageBox-&gt;setPlainText(currentItem-&gt;baseInstructions());</span>
<span class="lineNum">    1197 </span>                :            :             } else {
<span class="lineNum">    1198 </span>                :<span class="lineCov">          9 :                 currentItem-&gt;addPoint(pos);</span>
<span class="lineNum">    1199 </span>                :            :             }
<span class="lineNum">    1200 </span>                :<span class="lineCov">         10 :             scene-&gt;update();</span>
<span class="lineNum">    1201 </span>                :<span class="lineCov">         10 :             maskScene-&gt;update();</span>
<span class="lineNum">    1202 </span>                :<span class="lineCov">         10 :             return;</span>
<span class="lineNum">    1203 </span>                :            :         }
<span class="lineNum">    1204 </span>                :<span class="lineCov">         20 :         scene-&gt;inactiveAll();</span>
<span class="lineNum">    1205 </span>                :<span class="lineCov">         20 :         maskScene-&gt;inactiveAll();</span>
<span class="lineNum">    1206 </span>                :<span class="lineCov">         20 :         switch (currentSelectType) {</span>
<span class="lineNum">    1207 </span>                :            :             case SelectItem::Rectangle:
<span class="lineNum">    1208 </span>                :            :             {
<span class="lineNum">    1209 </span>                :<span class="lineCov">          9 :                 RectangleSelect *temp = new RectangleSelect(pos, currentLabel);</span>
<span class="lineNum">    1210 </span>                :<span class="lineCov">          9 :                 RectangleSelect *mirror = new RectangleSelect(pos);</span>
<span class="lineNum">    1211 </span>                :<span class="lineCov">          3 :                 tempItem = temp;</span>
<span class="lineNum">    1212 </span>                :<span class="lineCov">          3 :                 mirrorItem = mirror;</span>
<span class="lineNum">    1213 </span>                :<span class="lineCov">          6 :                 mirrorItem-&gt;setLabel(currentLabel);</span>
<span class="lineNum">    1214 </span>                :<span class="lineCov">          3 :                 mirrorItem-&gt;updatePen(mirrorItem-&gt;myPen);</span>
<span class="lineNum">    1215 </span>                :<span class="lineCov">          3 :                 tempItem-&gt;setMirror(mirrorItem);</span>
<span class="lineNum">    1216 </span>                :<span class="lineCov">          3 :                 mirrorItem-&gt;setMirror(tempItem);</span>
<span class="lineNum">    1217 </span>                :            :             }
<span class="lineNum">    1218 </span>                :<span class="lineCov">          3 :                 break;</span>
<span class="lineNum">    1219 </span>                :            :             case SelectItem::Ellipse:
<span class="lineNum">    1220 </span>                :            :             {
<span class="lineNum">    1221 </span>                :<span class="lineCov">         18 :                 EllipseSelect *temp = new EllipseSelect(pos, currentLabel);</span>
<span class="lineNum">    1222 </span>                :<span class="lineCov">         18 :                 EllipseSelect *mirror = new EllipseSelect(pos);</span>
<span class="lineNum">    1223 </span>                :<span class="lineCov">          6 :                 tempItem = temp;</span>
<span class="lineNum">    1224 </span>                :<span class="lineCov">          6 :                 mirrorItem = mirror;</span>
<span class="lineNum">    1225 </span>                :<span class="lineCov">         12 :                 mirrorItem-&gt;setLabel(currentLabel);</span>
<span class="lineNum">    1226 </span>                :<span class="lineCov">          6 :                 mirrorItem-&gt;updatePen(mirrorItem-&gt;myPen);</span>
<span class="lineNum">    1227 </span>                :<span class="lineCov">          6 :                 tempItem-&gt;setMirror(mirrorItem);</span>
<span class="lineNum">    1228 </span>                :<span class="lineCov">          6 :                 mirrorItem-&gt;setMirror(tempItem);</span>
<span class="lineNum">    1229 </span>                :            :             }
<span class="lineNum">    1230 </span>                :<span class="lineCov">          6 :                 break;</span>
<span class="lineNum">    1231 </span>                :            :             case SelectItem::Freeerase:
<span class="lineNum">    1232 </span>                :            :             case SelectItem::Freedraw:
<span class="lineNum">    1233 </span>                :            :             {
<span class="lineNum">    1234 </span>                :<span class="lineCov">          8 :                 if (drawing) {</span>
<span class="lineNum">    1235 </span>                :            :                     FreeDrawSelect *temp = new FreeDrawSelect(pos,
<span class="lineNum">    1236 </span>                :            :                                                               currentBrushSize,
<span class="lineNum">    1237 </span>                :            :                                                               brushMode,
<span class="lineNum">    1238 </span>                :<span class="lineCov">         12 :                                                               currentLabel);</span>
<span class="lineNum">    1239 </span>                :            :                     FreeDrawSelect *mirror = new FreeDrawSelect(pos,
<span class="lineNum">    1240 </span>                :<span class="lineCov">         12 :                                                                 temp-&gt;myPen);</span>
<span class="lineNum">    1241 </span>                :<span class="lineCov">          4 :                     tempItem = temp;</span>
<span class="lineNum">    1242 </span>                :<span class="lineCov">          4 :                     mirrorItem = mirror;</span>
<span class="lineNum">    1243 </span>                :<span class="lineCov">          8 :                     mirrorItem-&gt;setLabel(currentLabel);</span>
<span class="lineNum">    1244 </span>                :<span class="lineCov">          4 :                     mirrorItem-&gt;updatePen(temp-&gt;myPen);</span>
<span class="lineNum">    1245 </span>                :<span class="lineCov">          4 :                     tempItem-&gt;setMirror(mirrorItem);</span>
<span class="lineNum">    1246 </span>                :<span class="lineCov">          4 :                     mirrorItem-&gt;setMirror(tempItem);</span>
<span class="lineNum">    1247 </span>                :            :                 } else {
<span class="lineNum">    1248 </span>                :            :                     myErase = new FreeDrawErase(pos, currentBrushSize,
<span class="lineNum">    1249 </span>                :<span class="lineCov">         12 :                                                 brushMode, currentLabel);</span>
<span class="lineNum">    1250 </span>                :<span class="lineCov">          4 :                     currentItem = myErase;</span>
<span class="lineNum">    1251 </span>                :            :                 }
<span class="lineNum">    1252 </span>                :            :             }
<span class="lineNum">    1253 </span>                :            :                 break;
<span class="lineNum">    1254 </span>                :            :             case SelectItem::Polygon:
<span class="lineNum">    1255 </span>                :            :             {
<span class="lineNum">    1256 </span>                :<span class="lineCov">          9 :                 PolygonSelect *temp = new PolygonSelect(pos, currentLabel);</span>
<span class="lineNum">    1257 </span>                :<span class="lineCov">          9 :                 PolygonSelect *mirror = new PolygonSelect(pos);</span>
<span class="lineNum">    1258 </span>                :<span class="lineCov">          3 :                 tempItem = temp;</span>
<span class="lineNum">    1259 </span>                :<span class="lineCov">          3 :                 mirrorItem = mirror;</span>
<span class="lineNum">    1260 </span>                :<span class="lineCov">          6 :                 mirrorItem-&gt;setLabel(currentLabel);</span>
<span class="lineNum">    1261 </span>                :<span class="lineCov">          3 :                 mirrorItem-&gt;updatePen(mirrorItem-&gt;myPen);</span>
<span class="lineNum">    1262 </span>                :<span class="lineCov">          3 :                 tempItem-&gt;setMirror(mirrorItem);</span>
<span class="lineNum">    1263 </span>                :<span class="lineCov">          3 :                 mirrorItem-&gt;setMirror(tempItem);</span>
<span class="lineNum">    1264 </span>                :<span class="lineCov">          3 :                 polygonSelectForm-&gt;finishPolygonButton-&gt;setEnabled(true);</span>
<span class="lineNum">    1265 </span>                :            :             }
<span class="lineNum">    1266 </span>                :<span class="lineCov">          3 :                 break;</span>
<span class="lineNum">    1267 </span>                :            :         }
<span class="lineNum">    1268 </span>                :<span class="lineCov">         20 :         if ((currentSelectType != SelectItem::Freedraw &amp;&amp; currentSelectType !=</span>
<span class="lineNum">    1269 </span>                :<span class="lineCov">          8 :              SelectItem::Freeerase) || drawing) {</span>
<span class="lineNum">    1270 </span>                :<span class="lineCov">         32 :             mirrorItem-&gt;setLabel(currentLabel);</span>
<span class="lineNum">    1271 </span>                :<span class="lineCov">         16 :             mirrorItem-&gt;updatePen(tempItem-&gt;myPen);</span>
<span class="lineNum">    1272 </span>                :<span class="lineCov">         16 :             scene-&gt;addItem(tempItem);</span>
<span class="lineNum">    1273 </span>                :<span class="lineCov">         16 :             maskScene-&gt;addItem(mirrorItem);</span>
<span class="lineNum">    1274 </span>                :<span class="lineCov">         16 :             switch (type) {</span>
<span class="lineNum">    1275 </span>                :            :                 case PhotoScene::PHOTO_VIEWER_TYPE:
<span class="lineNum">    1276 </span>                :<span class="lineCov">         16 :                     currentItem = tempItem;</span>
<span class="lineNum">    1277 </span>                :<span class="lineCov">         16 :                     break;</span>
<span class="lineNum">    1278 </span>                :            :                 case PhotoScene::MASK_VIEWER_TYPE:
<span class="lineNum">    1279 </span>                :<span class="lineNoCov">          0 :                     currentItem = mirrorItem;</span>
<span class="lineNum">    1280 </span>                :<span class="lineNoCov">          0 :                     break;</span>
<span class="lineNum">    1281 </span>                :            :             }
<span class="lineNum">    1282 </span>                :<span class="lineCov">         16 :             if (!canDrawOnPhoto)</span>
<span class="lineNum">    1283 </span>                :<span class="lineNoCov">          0 :                 maskItem = currentItem;</span>
<span class="lineNum">    1284 </span>                :            :         }
<span class="lineNum">    1285 </span>                :<span class="lineCov">         20 :         scene-&gt;update();</span>
<span class="lineNum">    1286 </span>                :<span class="lineCov">         20 :         maskScene-&gt;update();</span>
<span class="lineNum">    1287 </span>                :            :     } else {
<span class="lineNum">    1288 </span>                :<span class="lineCov">          9 :         if (item-&gt;type() != currentSelectType) {</span>
<span class="lineNum">    1289 </span>                :<span class="lineCov">          2 :             if (!canDrawOnPhoto)</span>
<span class="lineNum">    1290 </span>                :            :                 return;
<span class="lineNum">    1291 </span>                :<span class="lineCov">          2 :             switch (item-&gt;type()) {</span>
<span class="lineNum">    1292 </span>                :            :                 case SelectItem::Freedraw:
<span class="lineNum">    1293 </span>                :<span class="lineNoCov">          0 :                     on_freeSelectButton_clicked();</span>
<span class="lineNum">    1294 </span>                :<span class="lineNoCov">          0 :                     break;</span>
<span class="lineNum">    1295 </span>                :            :                 case SelectItem::Polygon:
<span class="lineNum">    1296 </span>                :<span class="lineCov">          1 :                     on_polygonSelectButton_clicked();</span>
<span class="lineNum">    1297 </span>                :<span class="lineCov">          1 :                     polygonSelectForm-&gt;finishPolygonButton-&gt;setEnabled(true);</span>
<span class="lineNum">    1298 </span>                :<span class="lineCov">          1 :                     break;</span>
<span class="lineNum">    1299 </span>                :            :                 case SelectItem::Rectangle:
<span class="lineNum">    1300 </span>                :<span class="lineCov">          1 :                     on_rectangleSelectButton_clicked();</span>
<span class="lineNum">    1301 </span>                :<span class="lineCov">          1 :                     break;</span>
<span class="lineNum">    1302 </span>                :            :                 case SelectItem::Ellipse:
<span class="lineNum">    1303 </span>                :<span class="lineNoCov">          0 :                     on_ellipseSelectButton_clicked();</span>
<span class="lineNum">    1304 </span>                :<span class="lineNoCov">          0 :                     break;</span>
<span class="lineNum">    1305 </span>                :            :             }
<span class="lineNum">    1306 </span>                :            :         }
<span class="lineNum">    1307 </span>                :<span class="lineCov">          9 :         currentItem = item;</span>
<span class="lineNum">    1308 </span>                :<span class="lineCov">          9 :         if (!canDrawOnPhoto)</span>
<span class="lineNum">    1309 </span>                :<span class="lineNoCov">          0 :             maskItem = currentItem;</span>
<span class="lineNum">    1310 </span>                :<span class="lineCov">          9 :         currentLabel = currentItem-&gt;getLabel();</span>
<span class="lineNum">    1311 </span>                :<span class="lineCov">          9 :         scene-&gt;inactiveAll();</span>
<span class="lineNum">    1312 </span>                :<span class="lineCov">          9 :         maskScene-&gt;inactiveAll();</span>
<span class="lineNum">    1313 </span>                :<span class="lineCov">          9 :         currentItem-&gt;clickPoint(pos);</span>
<span class="lineNum">    1314 </span>                :<span class="lineCov">          9 :         currentItem-&gt;setItemActive();</span>
<span class="lineNum">    1315 </span>                :<span class="lineCov">          9 :         if (currentItem-&gt;type() == SelectItem::Polygon &amp;&amp; insertVertex) {</span>
<span class="lineNum">    1316 </span>                :<span class="lineCov">          2 :             int vert = currentItem-&gt;getActiveVertex();</span>
<span class="lineNum">    1317 </span>                :<span class="lineCov">          2 :             if (vert != SelectItem::UNSELECTED) {</span>
<span class="lineNum">    1318 </span>                :<span class="lineCov">          2 :                 if (vertex1 &lt;0) {</span>
<span class="lineNum">    1319 </span>                :<span class="lineCov">          1 :                     vertex1 = vert;</span>
<span class="lineNum">    1320 </span>                :<span class="lineCov">          1 :                     polygonSelectForm-&gt;polygonMessageBox-&gt;appendPlainText(&quot;First vertex selected.&quot;);</span>
<span class="lineNum">    1321 </span>                :<span class="lineCov">          1 :                 } else if (vertex2 &lt; 0) {</span>
<span class="lineNum">    1322 </span>                :<span class="lineCov">          1 :                     if (abs(vert - vertex1) != 1 &amp;&amp; abs(vert - vertex1) !=</span>
<span class="lineNum">    1323 </span>                :<span class="lineNoCov">          0 :                         (currentItem-&gt;numberOfVertices() - 1)) {</span>
<span class="lineNum">    1324 </span>                :<span class="lineNoCov">          0 :                         polygonSelectForm-&gt;polygonMessageBox-&gt;appendPlainText(&quot;Invalid second vertex, it must be adjacent to the first vertex.&quot;);</span>
<span class="lineNum">    1325 </span>                :            :                     } else {
<span class="lineNum">    1326 </span>                :<span class="lineCov">          1 :                         vertex2 = vert;</span>
<span class="lineNum">    1327 </span>                :<span class="lineCov">          1 :                         polygonSelectForm-&gt;polygonMessageBox-&gt;setPlainText(&quot;Click on the point where you want to insert a new vertex. (must be outside the current polygon, but can be dragged anywhere)&quot;);</span>
<span class="lineNum">    1328 </span>                :            :                     }
<span class="lineNum">    1329 </span>                :            :                 }
<span class="lineNum">    1330 </span>                :            :             }
<span class="lineNum">    1331 </span>                :            :         }
<span class="lineNum">    1332 </span>                :<span class="lineCov">          9 :         scene-&gt;update();</span>
<span class="lineNum">    1333 </span>                :<span class="lineCov">          9 :         maskScene-&gt;update();</span>
<span class="lineNum">    1334 </span>                :            :     }
<span class="lineNum">    1335 </span>                :            : }
<span class="lineNum">    1336 </span>                :            : 
<span class="lineNum">    1337 </span>                :            : /*!
<a name="1338"><span class="lineNum">    1338 </span>                :            :   Processes a mouse movement from \a fromPos to \a toPos.</a>
<span class="lineNum">    1339 </span>                :            :  */
<span class="lineNum">    1340 </span>                :<span class="lineCov">         43 : void InstaDam::processMouseMoved(QPointF fromPos, QPointF toPos) {</span>
<span class="lineNum">    1341 </span>                :<span class="lineCov">         43 :     if (currentItem) {</span>
<span class="lineNum">    1342 </span>                :<span class="lineCov">         43 :         if (currentButton == Qt::LeftButton) {</span>
<span class="lineNum">    1343 </span>                :            : 
<span class="lineNum">    1344 </span>                :<span class="lineCov">         42 :             currentItem-&gt;moveItem(fromPos, toPos);</span>
<span class="lineNum">    1345 </span>                :            :         } else {
<span class="lineNum">    1346 </span>                :<span class="lineCov">          1 :             currentItem-&gt;rotate(fromPos, toPos);</span>
<span class="lineNum">    1347 </span>                :            :         }
<span class="lineNum">    1348 </span>                :<span class="lineCov">         43 :         scene-&gt;update();</span>
<span class="lineNum">    1349 </span>                :<span class="lineCov">         43 :         maskScene-&gt;update();</span>
<span class="lineNum">    1350 </span>                :            :     }
<span class="lineNum">    1351 </span>                :<span class="lineCov">         43 : }</span>
<span class="lineNum">    1352 </span>                :            : 
<span class="lineNum">    1353 </span>                :            : /*!
<span class="lineNum">    1354 </span>                :            :   Processes a mouse button being released from scene \a type, mouse movement
<a name="1355"><span class="lineNum">    1355 </span>                :            :   from \a oldPos to \a newPos, and the button released \a button.</a>
<span class="lineNum">    1356 </span>                :            :  */
<span class="lineNum">    1357 </span>                :<span class="lineCov">         39 : void InstaDam::processMouseReleased(PhotoScene::viewerTypes type,</span>
<span class="lineNum">    1358 </span>                :            :                                     QPointF oldPos, QPointF newPos,
<span class="lineNum">    1359 </span>                :            :                                     const Qt::MouseButton button) {
<span class="lineNum">    1360 </span>                :            :     UNUSED(button);
<span class="lineNum">    1361 </span>                :<span class="lineCov">        112 :     if (currentItem &amp;&amp; !currentItem-&gt;isItemAdded()) {</span>
<span class="lineNum">    1362 </span>                :<span class="lineCov">         20 :         if (currentItem-&gt;type() == SelectItem::Freedraw &amp;&amp; type ==</span>
<span class="lineNum">    1363 </span>                :            :             PhotoScene::MASK_VIEWER_TYPE) {
<span class="lineNum">    1364 </span>                :<span class="lineNoCov">          0 :             FreeDrawSelect fds(maskSelection(currentItem), currentItem-&gt;myPen);</span>
<span class="lineNum">    1365 </span>                :<span class="lineNoCov">          0 :             FreeDrawSelect *temp = dynamic_cast&lt;FreeDrawSelect*&gt;(currentItem);</span>
<span class="lineNum">    1366 </span>                :<span class="lineNoCov">          0 :             temp-&gt;setPointsUnchecked(fds.getPixmap());</span>
<span class="lineNum">    1367 </span>                :            :         }
<span class="lineNum">    1368 </span>                :<span class="lineCov">         20 :         if (currentItem-&gt;type() == SelectItem::Freeerase) {</span>
<span class="lineNum">    1369 </span>                :            :             QUndoCommand *eraseCommand = new ErasePointsCommand(myErase, scene,
<span class="lineNum">    1370 </span>                :<span class="lineCov">          4 :                                                                 maskScene);</span>
<span class="lineNum">    1371 </span>                :<span class="lineCov">          4 :             undoGroup-&gt;activeStack()-&gt;push(eraseCommand);</span>
<span class="lineNum">    1372 </span>                :            :         } else {
<span class="lineNum">    1373 </span>                :            :             QUndoCommand *addCommand =
<span class="lineNum">    1374 </span>                :            :                     new AddCommand((type == PhotoScene::PHOTO_VIEWER_TYPE) ?
<span class="lineNum">    1375 </span>                :<span class="lineNoCov">          0 :                                        currentItem : currentItem-&gt;getMirror(),</span>
<span class="lineNum">    1376 </span>                :<span class="lineCov">         16 :                                    scene);</span>
<span class="lineNum">    1377 </span>                :<span class="lineCov">         16 :             undoGroup-&gt;activeStack()-&gt;push(addCommand);</span>
<span class="lineNum">    1378 </span>                :<span class="lineCov">         16 :             if (type == PhotoScene::MASK_VIEWER_TYPE)</span>
<span class="lineNum">    1379 </span>                :<span class="lineNoCov">          0 :                 currentItem-&gt;setFromMaskScene(true);</span>
<span class="lineNum">    1380 </span>                :<span class="lineCov">         16 :             if (ui-&gt;showMaskSelections-&gt;checkState() == Qt::Unchecked)</span>
<span class="lineNum">    1381 </span>                :<span class="lineCov">         16 :                 currentItem-&gt;hideMask();</span>
<span class="lineNum">    1382 </span>                :            :         }
<span class="lineNum">    1383 </span>                :<span class="lineCov">         20 :         currentItem-&gt;resetState();</span>
<span class="lineNum">    1384 </span>                :<span class="lineCov">         20 :         if (currentItem-&gt;type() != SelectItem::Polygon) {</span>
<span class="lineNum">    1385 </span>                :<span class="lineCov">         17 :             currentItem = nullptr;</span>
<span class="lineNum">    1386 </span>                :            :         } else {
<span class="lineNum">    1387 </span>                :<span class="lineCov">          3 :             currentItem-&gt;setActiveVertex(SelectItem::UNSELECTED);</span>
<span class="lineNum">    1388 </span>                :            :         }
<span class="lineNum">    1389 </span>                :<span class="lineCov">         73 :     } else if (currentItem &amp;&amp; (currentItem-&gt;wasMoved() ||</span>
<span class="lineNum">    1390 </span>                :<span class="lineCov">         14 :                                currentItem-&gt;wasResized() ||</span>
<span class="lineNum">    1391 </span>                :            :                                currentItem-&gt;wasRotated())) {
<span class="lineNum">    1392 </span>                :<span class="lineCov">          6 :         if (currentItem-&gt;wasMoved()) {</span>
<span class="lineNum">    1393 </span>                :            :             QUndoCommand *moveCommand =
<span class="lineNum">    1394 </span>                :            :                     new MoveCommand((type == PhotoScene::PHOTO_VIEWER_TYPE) ?
<span class="lineNum">    1395 </span>                :<span class="lineNoCov">          0 :                                         currentItem : currentItem-&gt;getMirror(),</span>
<span class="lineNum">    1396 </span>                :<span class="lineCov">          3 :                                     oldPos, newPos);</span>
<span class="lineNum">    1397 </span>                :<span class="lineCov">          3 :             undoGroup-&gt;activeStack()-&gt;push(moveCommand);</span>
<span class="lineNum">    1398 </span>                :<span class="lineCov">          3 :         } else if (currentItem-&gt;wasResized()) {</span>
<span class="lineNum">    1399 </span>                :            :             QUndoCommand *resizeCommand =
<span class="lineNum">    1400 </span>                :            :                     new MoveVertexCommand((type == PhotoScene::PHOTO_VIEWER_TYPE) ?
<span class="lineNum">    1401 </span>                :<span class="lineNoCov">          0 :                                               currentItem : currentItem-&gt;getMirror(),</span>
<span class="lineNum">    1402 </span>                :            :                                           oldPos, newPos,
<span class="lineNum">    1403 </span>                :<span class="lineCov">          4 :                                           currentItem-&gt;getActiveVertex());</span>
<span class="lineNum">    1404 </span>                :<span class="lineCov">          2 :             undoGroup-&gt;activeStack()-&gt;push(resizeCommand);</span>
<span class="lineNum">    1405 </span>                :            :         } else {
<span class="lineNum">    1406 </span>                :            :             QUndoCommand *rotateCommand =
<span class="lineNum">    1407 </span>                :            :                     new RotateCommand((type == PhotoScene::PHOTO_VIEWER_TYPE) ?
<span class="lineNum">    1408 </span>                :<span class="lineNoCov">          0 :                                           currentItem : currentItem-&gt;getMirror(),</span>
<span class="lineNum">    1409 </span>                :<span class="lineCov">          1 :                                       oldPos, newPos);</span>
<span class="lineNum">    1410 </span>                :<span class="lineCov">          1 :             undoGroup-&gt;activeStack()-&gt;push(rotateCommand);</span>
<span class="lineNum">    1411 </span>                :            :         }
<span class="lineNum">    1412 </span>                :<span class="lineCov">          6 :         currentItem-&gt;resetState();</span>
<span class="lineNum">    1413 </span>                :<span class="lineCov">         26 :     } else if (currentItem &amp;&amp; currentItem-&gt;type() == SelectItem::Polygon &amp;&amp;</span>
<span class="lineNum">    1414 </span>                :<span class="lineCov">         13 :                currentItem-&gt;wasPointAdded()) {</span>
<span class="lineNum">    1415 </span>                :            :         QUndoCommand *addVertexCommand =
<span class="lineNum">    1416 </span>                :            :                 new AddVertexCommand((type == PhotoScene::PHOTO_VIEWER_TYPE) ?
<span class="lineNum">    1417 </span>                :<span class="lineNoCov">          0 :                                          currentItem : currentItem-&gt;getMirror(),</span>
<span class="lineNum">    1418 </span>                :<span class="lineCov">         10 :                                      newPos);</span>
<span class="lineNum">    1419 </span>                :<span class="lineCov">         10 :         undoGroup-&gt;activeStack()-&gt;push(addVertexCommand);</span>
<span class="lineNum">    1420 </span>                :<span class="lineCov">         10 :         currentItem-&gt;setActiveVertex(SelectItem::UNSELECTED);</span>
<span class="lineNum">    1421 </span>                :<span class="lineCov">         10 :         currentItem-&gt;resetState();</span>
<span class="lineNum">    1422 </span>                :            :     }
<span class="lineNum">    1423 </span>                :<span class="lineCov">         39 :     currentButton = Qt::NoButton;</span>
<span class="lineNum">    1424 </span>                :<span class="lineCov">         39 :     scene-&gt;update();</span>
<span class="lineNum">    1425 </span>                :<span class="lineCov">         39 :     maskScene-&gt;update();</span>
<span class="lineNum">    1426 </span>                :<span class="lineCov">         39 : }</span>
<span class="lineNum">    1427 </span>                :            : 
<span class="lineNum">    1428 </span>                :            : 
<span class="lineNum">    1429 </span>                :            : /*!
<a name="1430"><span class="lineNum">    1430 </span>                :            :  Closes the current polygon.</a>
<span class="lineNum">    1431 </span>                :            :  */
<span class="lineNum">    1432 </span>                :<span class="lineCov">          3 : void InstaDam::finishPolygonButtonClicked() {</span>
<span class="lineNum">    1433 </span>                :<span class="lineCov">          3 :     if (currentItem) {</span>
<span class="lineNum">    1434 </span>                :            :         currentItem-&gt;setActiveVertex(SelectItem::UNSELECTED);
<span class="lineNum">    1435 </span>                :            :         currentItem-&gt;setInactive();
<span class="lineNum">    1436 </span>                :<span class="lineCov">          3 :         polygonSelectForm-&gt;finishPolygonButton-&gt;setEnabled(false);</span>
<span class="lineNum">    1437 </span>                :            :     }
<span class="lineNum">    1438 </span>                :<span class="lineCov">          3 :     currentItem = nullptr;</span>
<span class="lineNum">    1439 </span>                :<span class="lineCov">          3 :     scene-&gt;update();</span>
<span class="lineNum">    1440 </span>                :<span class="lineCov">          3 :     maskScene-&gt;update();</span>
<span class="lineNum">    1441 </span>                :<span class="lineCov">          3 : }</span>
<span class="lineNum">    1442 </span>                :            : 
<span class="lineNum">    1443 </span>                :            : /*!
<span class="lineNum">    1444 </span>                :            :  Defines keyboard modifier actions (delet and X) \a key for a viewerTypes of
<a name="1445"><span class="lineNum">    1445 </span>                :            :  \a type.</a>
<span class="lineNum">    1446 </span>                :            :  */
<span class="lineNum">    1447 </span>                :<span class="lineNoCov">          0 : void InstaDam::processKeyPressed(PhotoScene::viewerTypes type, const int key) {</span>
<span class="lineNum">    1448 </span>                :<span class="lineNoCov">          0 :     if (!currentItem) {</span>
<span class="lineNum">    1449 </span>                :<span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    1450 </span>                :<span class="lineNoCov">          0 :     } else if (key == Qt::Key_Delete || key == Qt::Key_Backspace) {</span>
<span class="lineNum">    1451 </span>                :<span class="lineNoCov">          0 :         if (currentItem-&gt;type() == SelectItem::Polygon &amp;&amp;</span>
<span class="lineNum">    1452 </span>                :<span class="lineNoCov">          0 :             currentItem-&gt;getActiveVertex() != SelectItem::UNSELECTED) {</span>
<span class="lineNum">    1453 </span>                :            :             QUndoCommand *deleteVertexCommand =
<span class="lineNum">    1454 </span>                :            :                     new DeleteVertexCommand((type == PhotoScene::PHOTO_VIEWER_TYPE) ?
<span class="lineNum">    1455 </span>                :<span class="lineNoCov">          0 :                                                 currentItem : currentItem-&gt;getMirror());</span>
<span class="lineNum">    1456 </span>                :<span class="lineNoCov">          0 :             undoGroup-&gt;activeStack()-&gt;push(deleteVertexCommand);</span>
<span class="lineNum">    1457 </span>                :            :         } else {
<span class="lineNum">    1458 </span>                :            :             QUndoCommand *deleteCommand =
<span class="lineNum">    1459 </span>                :            :                     new DeleteCommand((type == PhotoScene::PHOTO_VIEWER_TYPE) ?
<span class="lineNum">    1460 </span>                :<span class="lineNoCov">          0 :                                           currentItem : currentItem-&gt;getMirror(),</span>
<span class="lineNum">    1461 </span>                :<span class="lineNoCov">          0 :                                       scene);</span>
<span class="lineNum">    1462 </span>                :<span class="lineNoCov">          0 :             undoGroup-&gt;activeStack()-&gt;push(deleteCommand);</span>
<span class="lineNum">    1463 </span>                :            :         }
<span class="lineNum">    1464 </span>                :<span class="lineNoCov">          0 :     } else if (key == Qt::Key_X || key == Qt::Key_X + Qt::Key_Shift) {</span>
<span class="lineNum">    1465 </span>                :<span class="lineNoCov">          0 :         currentItem = nullptr;</span>
<span class="lineNum">    1466 </span>                :            :     }
<span class="lineNum">    1467 </span>                :            : }
<span class="lineNum">    1468 </span>                :            : 
<span class="lineNum">    1469 </span>                :            : /*!
<span class="lineNum">    1470 </span>                :            :   Reads a QJsonObject \a json of fileTypes \a type.
<span class="lineNum">    1471 </span>                :            :  */
<span class="lineNum">    1472 </span>                :<span class="lineCov">          2 : bool InstaDam::read(const QJsonObject &amp;json, fileTypes type) {</span>
<span class="lineNum">    1473 </span>                :<span class="lineCov">          4 :     if (json.contains(&quot;labels&quot;) &amp;&amp; json[&quot;labels&quot;].isArray()) {</span>
<span class="lineNum">    1474 </span>                :<span class="lineCov">          2 :         QJsonArray labelArray = json[&quot;labels&quot;].toArray();</span>
<span class="lineNum">    1475 </span>                :<span class="lineCov">          2 :         tempLabels.clear();</span>
<span class="lineNum">    1476 </span>                :<span class="lineCov">          2 :         tempLabels.reserve(labelArray.size());</span>
<span class="lineNum">    1477 </span>                :<span class="lineCov">          8 :         for (int i = 0; i &lt; labelArray.size(); i++) {</span>
<span class="lineNum">    1478 </span>                :            :             QSharedPointer&lt;Label&gt; label =
<span class="lineNum">    1479 </span>                :<span class="lineCov">          6 :                     QSharedPointer&lt;Label&gt;::create(labelArray[i].toObject(), i);</span>
<span class="lineNum">    1480 </span>                :            :             tempLabels.push_back(label);
<span class="lineNum">    1481 </span>                :            :         }
<span class="lineNum">    1482 </span>                :<span class="lineCov">          2 :         if (type == PROJECT) {</span>
<span class="lineNum">    1483 </span>                :<span class="lineCov">          1 :             currentProject = newProject-&gt;newPr;</span>
<span class="lineNum">    1484 </span>                :<span class="lineCov">          1 :             setLabels();</span>
<span class="lineNum">    1485 </span>                :<span class="lineCov">          1 :             scene-&gt;clearItems();</span>
<span class="lineNum">    1486 </span>                :<span class="lineCov">          1 :             maskScene-&gt;clearItems();</span>
<span class="lineNum">    1487 </span>                :<span class="lineCov">          2 :             currentProject-&gt;setLabels(tempLabels);</span>
<span class="lineNum">    1488 </span>                :<span class="lineCov">          2 :             QTextStream(stdout) &lt;&lt; currentProject-&gt;numLabels() &lt;&lt; &quot;\n&quot;;</span>
<span class="lineNum">    1489 </span>                :            :         } else {
<span class="lineNum">    1490 </span>                :<span class="lineCov">          2 :             QStringList current = getLabelNames(currentProject-&gt;getLabels());</span>
<span class="lineNum">    1491 </span>                :<span class="lineCov">          1 :             QStringList newList = getLabelNames(tempLabels);</span>
<span class="lineNum">    1492 </span>                :            :             current.sort(Qt::CaseInsensitive);
<span class="lineNum">    1493 </span>                :            :             newList.sort(Qt::CaseInsensitive);
<span class="lineNum">    1494 </span>                :<span class="lineCov">          1 :             if (current.size() != 0 &amp;&amp; current != newList) {</span>
<span class="lineNum">    1495 </span>                :<span class="lineNoCov">          0 :                 QDialog *dialog = new QDialog(this);</span>
<span class="lineNum">    1496 </span>                :<span class="lineNoCov">          0 :                 Ui::projectDialog *projectDialog = new Ui::projectDialog;</span>
<span class="lineNum">    1497 </span>                :<span class="lineNoCov">          0 :                 projectDialog-&gt;setupUi(dialog);</span>
<span class="lineNum">    1498 </span>                :            :                 projectDialog-&gt;differences-&gt;setRowCount(std::max(current.size(),
<span class="lineNum">    1499 </span>                :<span class="lineNoCov">          0 :                                                                  newList.size()));</span>
<span class="lineNum">    1500 </span>                :<span class="lineNoCov">          0 :                 for (int i = 0; i &lt; current.size(); i++) {</span>
<span class="lineNum">    1501 </span>                :<span class="lineNoCov">          0 :                     QTableWidgetItem *newItem = new QTableWidgetItem(current.at(i));</span>
<span class="lineNum">    1502 </span>                :<span class="lineNoCov">          0 :                     projectDialog-&gt;differences-&gt;setItem(i, 0, newItem);</span>
<span class="lineNum">    1503 </span>                :            :                 }
<span class="lineNum">    1504 </span>                :<span class="lineNoCov">          0 :                 for (int i = 0; i&lt; newList.size(); i++) {</span>
<span class="lineNum">    1505 </span>                :<span class="lineNoCov">          0 :                     QTableWidgetItem *newItem = new QTableWidgetItem(newList.at(i));</span>
<span class="lineNum">    1506 </span>                :<span class="lineNoCov">          0 :                     projectDialog-&gt;differences-&gt;setItem(i, 1, newItem);</span>
<span class="lineNum">    1507 </span>                :            :                 }
<span class="lineNum">    1508 </span>                :            : 
<span class="lineNum">    1509 </span>                :            :                 connect(projectDialog-&gt;keepButton, SIGNAL(clicked()), dialog,
<span class="lineNum">    1510 </span>                :<span class="lineNoCov">          0 :                         SLOT(accept()));</span>
<span class="lineNum">    1511 </span>                :            :                 connect(projectDialog-&gt;cancelButton, SIGNAL(clicked()), dialog,
<span class="lineNum">    1512 </span>                :<span class="lineNoCov">          0 :                         SLOT(reject()));</span>
<span class="lineNum">    1513 </span>                :            :                 connect(projectDialog-&gt;loadNewButton, &amp;QPushButton::clicked, dialog,
<span class="lineNum">    1514 </span>                :<span class="lineNoCov">          0 :                         [=]() {dialog-&gt;done(2);});</span>
<span class="lineNum">    1515 </span>                :<span class="lineNoCov">          0 :                 dialog-&gt;exec();</span>
<span class="lineNum">    1516 </span>                :<span class="lineNoCov">          0 :                 if (dialog-&gt;result() == QDialog::Rejected) {</span>
<span class="lineNum">    1517 </span>                :            :                     return false;
<span class="lineNum">    1518 </span>                :<span class="lineNoCov">          0 :                 } else if (dialog-&gt;result() == 2) {</span>
<span class="lineNum">    1519 </span>                :<span class="lineNoCov">          0 :                     currentProject-&gt;setLabels(tempLabels);</span>
<span class="lineNum">    1520 </span>                :            :                 }
<span class="lineNum">    1521 </span>                :            :             } else {
<span class="lineNum">    1522 </span>                :<span class="lineCov">          2 :                 currentProject-&gt;setLabels(tempLabels);</span>
<span class="lineNum">    1523 </span>                :            :             }
<span class="lineNum">    1524 </span>                :<span class="lineCov">          2 :             QTextStream(stdout) &lt;&lt; currentProject-&gt;numLabels();</span>
<span class="lineNum">    1525 </span>                :<span class="lineCov">          2 :         }</span>
<span class="lineNum">    1526 </span>                :            :     }
<span class="lineNum">    1527 </span>                :            :     return true;
<span class="lineNum">    1528 </span>                :            : }
<span class="lineNum">    1529 </span>                :            : 
<span class="lineNum">    1530 </span>                :            : /*!
<a name="1531"><span class="lineNum">    1531 </span>                :            :   Writes a QJsonObject \a json of fileTypes \a type.</a>
<span class="lineNum">    1532 </span>                :            :  */
<span class="lineNum">    1533 </span>                :<span class="lineCov">          2 : void InstaDam::write(QJsonObject &amp;json, fileTypes type) {</span>
<span class="lineNum">    1534 </span>                :<span class="lineCov">          2 :     QJsonArray labs;</span>
<span class="lineNum">    1535 </span>                :<span class="lineCov">          6 :     for (int i = 0; i &lt; currentProject-&gt;numLabels(); i++) {</span>
<span class="lineNum">    1536 </span>                :<span class="lineCov">          6 :         QJsonObject lab;</span>
<span class="lineNum">    1537 </span>                :<span class="lineCov">          6 :         if (type== PROJECT) {</span>
<span class="lineNum">    1538 </span>                :<span class="lineCov">          9 :             currentProject-&gt;getLabel(i)-&gt;write(lab);</span>
<span class="lineNum">    1539 </span>                :<span class="lineCov">          3 :         } else if (type == ANNOTATION) {</span>
<span class="lineNum">    1540 </span>                :<span class="lineCov">          9 :             currentProject-&gt;getLabel(i)-&gt;writeIdantn(lab);</span>
<span class="lineNum">    1541 </span>                :            :         }
<span class="lineNum">    1542 </span>                :<span class="lineCov">          6 :         labs.append(lab);</span>
<span class="lineNum">    1543 </span>                :<span class="lineCov">          6 :     }</span>
<span class="lineNum">    1544 </span>                :<span class="lineCov">          2 :     json[&quot;labels&quot;] = labs;</span>
<span class="lineNum">    1545 </span>                :<span class="lineCov">          2 : }</span>
<span class="lineNum">    1546 </span>                :            : 
<span class="lineNum">    1547 </span>                :            : /*!
<a name="1548"><span class="lineNum">    1548 </span>                :            :  Rasterizes the selection from the mask viewer.</a>
<span class="lineNum">    1549 </span>                :            :  */
<span class="lineNum">    1550 </span>                :<span class="lineNoCov">          0 : void InstaDam::addCurrentSelection() {</span>
<span class="lineNum">    1551 </span>                :<span class="lineNoCov">          0 :     tempUndoStack-&gt;clear();</span>
<span class="lineNum">    1552 </span>                :<span class="lineNoCov">          0 :     undoGroup-&gt;setActiveStack(mainUndoStack);</span>
<span class="lineNum">    1553 </span>                :            :     FreeDrawSelect *fds = new FreeDrawSelect(maskSelection(maskItem),
<span class="lineNum">    1554 </span>                :<span class="lineNoCov">          0 :                                              currentLabel);</span>
<span class="lineNum">    1555 </span>                :<span class="lineNoCov">          0 :     scene-&gt;addItem(fds);</span>
<span class="lineNum">    1556 </span>                :<span class="lineNoCov">          0 :     QUndoCommand *addCommand = new AddCommand(fds, scene);</span>
<span class="lineNum">    1557 </span>                :<span class="lineNoCov">          0 :     mainUndoStack-&gt;push(addCommand);</span>
<span class="lineNum">    1558 </span>                :<span class="lineNoCov">          0 :     scene-&gt;removeItem(maskItem-&gt;getMirror());</span>
<span class="lineNum">    1559 </span>                :<span class="lineNoCov">          0 :     maskScene-&gt;removeItem(maskItem-&gt;getMirror());</span>
<span class="lineNum">    1560 </span>                :<span class="lineNoCov">          0 :     scene-&gt;removeItem(maskItem);</span>
<span class="lineNum">    1561 </span>                :<span class="lineNoCov">          0 :     maskScene-&gt;removeItem(maskItem);</span>
<span class="lineNum">    1562 </span>                :<span class="lineNoCov">          0 :     maskItem = nullptr;</span>
<span class="lineNum">    1563 </span>                :<span class="lineNoCov">          0 :     ui-&gt;addSelectionButton-&gt;setDisabled(true);</span>
<span class="lineNum">    1564 </span>                :<span class="lineNoCov">          0 :     ui-&gt;cancelSelectionButton-&gt;setDisabled(true);</span>
<span class="lineNum">    1565 </span>                :<span class="lineNoCov">          0 :     canDrawOnPhoto = true;</span>
<span class="lineNum">    1566 </span>                :<span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1567 </span>                :            : 
<span class="lineNum">    1568 </span>                :            : /*!
<a name="1569"><span class="lineNum">    1569 </span>                :            :  Cancels the current selection.</a>
<span class="lineNum">    1570 </span>                :            :  */
<span class="lineNum">    1571 </span>                :<span class="lineCov">         25 : void InstaDam::cancelCurrentSelection() {</span>
<span class="lineNum">    1572 </span>                :<span class="lineCov">         25 :     undoGroup-&gt;setActiveStack(mainUndoStack);</span>
<span class="lineNum">    1573 </span>                :<span class="lineCov">         25 :     canDrawOnPhoto = true;</span>
<span class="lineNum">    1574 </span>                :<span class="lineCov">         50 :     if (!ui-&gt;addSelectionButton-&gt;isEnabled()) {</span>
<span class="lineNum">    1575 </span>                :<span class="lineCov">         25 :         return;</span>
<span class="lineNum">    1576 </span>                :            :     }
<span class="lineNum">    1577 </span>                :<span class="lineNoCov">          0 :     tempUndoStack-&gt;clear();</span>
<span class="lineNum">    1578 </span>                :<span class="lineNoCov">          0 :     scene-&gt;removeItem(maskItem-&gt;getMirror());</span>
<span class="lineNum">    1579 </span>                :<span class="lineNoCov">          0 :     maskScene-&gt;removeItem(maskItem-&gt;getMirror());</span>
<span class="lineNum">    1580 </span>                :<span class="lineNoCov">          0 :     scene-&gt;removeItem(maskItem);</span>
<span class="lineNum">    1581 </span>                :<span class="lineNoCov">          0 :     maskScene-&gt;removeItem(maskItem);</span>
<span class="lineNum">    1582 </span>                :<span class="lineNoCov">          0 :     maskItem = nullptr;</span>
<span class="lineNum">    1583 </span>                :<span class="lineNoCov">          0 :     ui-&gt;addSelectionButton-&gt;setDisabled(true);</span>
<span class="lineNum">    1584 </span>                :<span class="lineNoCov">          0 :     ui-&gt;cancelSelectionButton-&gt;setDisabled(true);</span>
<span class="lineNum">    1585 </span>                :            : }
<span class="lineNum">    1586 </span>                :            : 
<span class="lineNum">    1587 </span>                :            : /*!
<a name="1588"><span class="lineNum">    1588 </span>                :            :  * Conducts the pixmap operation of masking on the SelectItem*\a item.</a>
<span class="lineNum">    1589 </span>                :            :  */
<span class="lineNum">    1590 </span>                :<span class="lineNoCov">          0 : QPixmap InstaDam::maskSelection(SelectItem *item) {</span>
<span class="lineNum">    1591 </span>                :<span class="lineNoCov">          0 :     QPixmap map(SelectItem::myBounds);</span>
<span class="lineNum">    1592 </span>                :<span class="lineNoCov">          0 :     map.fill(Qt::transparent);</span>
<span class="lineNum">    1593 </span>                :<span class="lineNoCov">          0 :     QPainter *paint = new QPainter(&amp;map);</span>
<span class="lineNum">    1594 </span>                :<span class="lineNoCov">          0 :     QBrush brush(currentLabel-&gt;getColor());</span>
<span class="lineNum">    1595 </span>                :<span class="lineNoCov">          0 :     paint-&gt;setPen(currentLabel-&gt;getColor());</span>
<span class="lineNum">    1596 </span>                :<span class="lineNoCov">          0 :     paint-&gt;setBrush(brush);</span>
<span class="lineNum">    1597 </span>                :<span class="lineNoCov">          0 :     paint-&gt;setCompositionMode(QPainter::CompositionMode_SourceOver);</span>
<span class="lineNum">    1598 </span>                :<span class="lineNoCov">          0 :     item-&gt;toPixmap(paint);</span>
<span class="lineNum">    1599 </span>                :<span class="lineNoCov">          0 :     paint-&gt;end();</span>
<span class="lineNum">    1600 </span>                :<span class="lineNoCov">          0 :     map = joinPixmaps(ui-&gt;IdmMaskViewer-&gt;photo-&gt;pixmap(), map,</span>
<span class="lineNum">    1601 </span>                :            :                       QPainter::CompositionMode_DestinationIn);
<span class="lineNum">    1602 </span>                :<span class="lineNoCov">          0 :     return map;</span>
<a name="1603"><span class="lineNum">    1603 </span>                :            : }</a>
<span class="lineNum">    1604 </span>                :            : 
<span class="lineNum">    1605 </span>                :<span class="lineNoCov">          0 : void InstaDam::on_addSelectionButton_clicked() {</span>
<span class="lineNum">    1606 </span>                :<span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1607 </span>                :            : 
<span class="lineNum">    1608 </span>                :            : 
<span class="lineNum">    1609 </span>                :            : /*!
<a name="1610"><span class="lineNum">    1610 </span>                :            :   Sets the current project to \a pr.</a>
<span class="lineNum">    1611 </span>                :            :   */
<span class="lineNum">    1612 </span>                :<span class="lineNoCov">          0 : void InstaDam::setCurrentProject(Project* pr) {</span>
<span class="lineNum">    1613 </span>                :<span class="lineNoCov">          0 :     this-&gt;currentProject = pr;</span>
<span class="lineNum">    1614 </span>                :<span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1615 </span>                :            : 
<span class="lineNum">    1616 </span>                :            : /*!
<span class="lineNum">    1617 </span>                :            :  Gets the list of label names from QVector \a labels.
<span class="lineNum">    1618 </span>                :            :  */
<span class="lineNum">    1619 </span>                :<span class="lineCov">          2 : QStringList InstaDam::getLabelNames(QVector&lt;QSharedPointer&lt;Label&gt; &gt; labels) {</span>
<span class="lineNum">    1620 </span>                :            :     QStringList labelList;
<span class="lineNum">    1621 </span>                :            :     QVectorIterator&lt;QSharedPointer&lt;Label&gt; &gt; it(labels);
<span class="lineNum">    1622 </span>                :<span class="lineCov">          5 :     while (it.hasNext()) {</span>
<span class="lineNum">    1623 </span>                :<span class="lineCov">          3 :         labelList.append(it.next()-&gt;getText());</span>
<span class="lineNum">    1624 </span>                :            :     }
<span class="lineNum">    1625 </span>                :<span class="lineCov">          2 :     return labelList;</span>
<span class="lineNum">    1626 </span>                :            : }
<span class="lineNum">    1627 </span>                :            : 
<span class="lineNum">    1628 </span>                :            : /*!
<a name="1629"><span class="lineNum">    1629 </span>                :            :  Reverts to the current label list during an annotation opening conflict.</a>
<span class="lineNum">    1630 </span>                :            :  */
<span class="lineNum">    1631 </span>                :<span class="lineNoCov">          0 : void InstaDam::revert() {</span>
<span class="lineNum">    1632 </span>                :<span class="lineNoCov">          0 :     this-&gt;filename = this-&gt;oldFilename;</span>
<span class="lineNum">    1633 </span>                :<span class="lineNoCov">          0 :     this-&gt;file = this-&gt;oldFile;</span>
<span class="lineNum">    1634 </span>                :<span class="lineNoCov">          0 :     this-&gt;path = this-&gt;oldPath;</span>
<span class="lineNum">    1635 </span>                :            :     this-&gt;imagesList = this-&gt;oldImagesList;
<span class="lineNum">    1636 </span>                :<span class="lineNoCov">          0 :     this-&gt;annotationPath = this-&gt;oldAnnotationPath;</span>
<span class="lineNum">    1637 </span>                :<span class="lineNoCov">          0 :     this-&gt;labelPaths = this-&gt;oldLabelPaths;</span>
<span class="lineNum">    1638 </span>                :<span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1639 </span>                :            : 
<span class="lineNum">    1640 </span>                :            : /*!
<a name="1641"><span class="lineNum">    1641 </span>                :            :  Toggles hiding the labels on the mask viewer.</a>
<span class="lineNum">    1642 </span>                :            :  */
<span class="lineNum">    1643 </span>                :<span class="lineNoCov">          0 : void InstaDam::processShowHide(int state) {</span>
<span class="lineNum">    1644 </span>                :<span class="lineNoCov">          0 :     for (int i = 0; i &lt; currentProject-&gt;numLabels(); i++) {</span>
<a name="1645"><span class="lineNum">    1645 </span>                :<span class="lineNoCov">          0 :          currentProject-&gt;getLabel(i)-&gt;setMaskState(state);</span></a>
<span class="lineNum">    1646 </span>                :            :     }
<span class="lineNum">    1647 </span>                :<span class="lineCov">          3 : }</span>
<span class="lineNum">    1648 </span>                :            : 
<span class="lineNum">    1649 </span>                :            : 
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.13</a></td></tr>
  </table>
  <br>

</body>
</html>
